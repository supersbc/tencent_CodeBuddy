# TDSQL 部署资源预测系统 - 详细配置清单说明

## 📋 功能概述

预测系统现已升级，提供**完整的硬件配置清单和详细报价单**，包括：

### ✅ 已实现的详细清单

1. **🖥️ 服务器配置清单**
   - 数据库服务器（按分片和主从角色详细列出）
   - TDSQL代理服务器
   - 应用服务器
   - 监控服务器
   - 备份服务器
   - 每台服务器包含：编号、角色、型号、CPU、内存、存储、网络、单价

2. **🌐 网络设备清单**
   - 核心交换机（双机热备）
   - 接入交换机
   - 防火墙（双机热备）
   - 负载均衡器（双机热备）
   - 边界路由器
   - 每台设备包含：编号、类型、型号、端口规格、吞吐量、单价

3. **💾 存储设备清单**
   - 存储类型（SSD SATA / NVMe SSD）
   - 存储容量（TB）
   - IOPS性能指标
   - 吞吐量指标
   - 单价和总价

4. **🏢 基础设施清单**
   - 42U标准机柜
   - PDU电源分配单元
   - UPS不间断电源（按功率计算）
   - 网线及配件

5. **📊 详细报价单**
   - **硬件成本**
     - 服务器小计
     - 网络设备小计
     - 存储设备小计
     - 基础设施小计
   - **软件许可证**
     - TDSQL企业版许可证（按CPU核心数计费）
     - 操作系统许可证（Red Hat Enterprise Linux）
     - 监控软件（Prometheus套件）
     - 备份软件
   - **实施服务**
     - 部署实施费用
     - 技术培训
   - **年度运营成本**
     - 电力成本
     - 制冷成本
     - 维护成本
   - **成本汇总**
     - 初始投资总额
     - 三年TCO总成本

## 🎯 使用方法

### 1. 访问预测页面
```
http://127.0.0.1:5173/predict
```

### 2. 填写业务需求
- **普通版**：填写基本参数（数据规模、QPS、TPS、并发连接数等）
- **专业版**：填写详细的业务、性能、安全、运维需求

### 3. 查看预测结果
系统会生成包含以下内容的完整报告：

#### 📈 架构方案
- 架构类型和描述
- 节点分布（数据库、代理、应用、监控）
- 分片和副本配置

#### 💰 成本总览
- 初始投资
- 三年TCO
- 年度运营成本
- 月度运营成本

#### 🖥️ 服务器配置清单（表格形式）
| 编号 | 角色 | 型号 | CPU | 内存 | 存储 | 网络 | 单价 |
|------|------|------|-----|------|------|------|------|
| db-01 | 数据库节点 (Shard-1 MASTER) | Dell PowerEdge R640 | 16核 Intel Xeon Gold 5218 | 64GB | 2000GB SSD SATA | 双万兆网卡 | ¥45,000 |
| ... | ... | ... | ... | ... | ... | ... | ... |

#### 🌐 网络设备清单（表格形式）
| 编号 | 类型 | 型号 | 规格 | 数量 | 单价 | 小计 |
|------|------|------|------|------|------|------|
| core-sw-01 | 核心交换机（主） | Cisco Nexus 93180YC-FX | 48x10Gbps | 1 | ¥85,000 | ¥85,000 |
| ... | ... | ... | ... | ... | ... | ... |

#### 💾 存储设备清单
#### 🏢 基础设施清单
#### 📊 详细报价单（分类汇总）

### 4. 导出和打印
- **📄 导出Excel报价单**：生成Excel格式的详细报价单（开发中）
- **📑 导出PDF方案书**：生成PDF格式的完整方案书（开发中）
- **🖨️ 打印报告**：直接打印当前页面（已优化打印样式）

## 📊 示例输出

### 测试参数
```json
{
  "total_data_size_gb": 500,
  "qps": 2000,
  "tps": 600,
  "concurrent_connections": 200,
  "need_high_availability": true
}
```

### 预测结果
```
【架构方案】
  类型: sharded - 分片集群架构 - 适用于大规模应用，支持水平扩展
  分片数: 2
  副本数: 2
  数据库节点: 6
  代理节点: 2
  应用节点: 2

【设备统计】
  服务器: 12 台
  网络设备: 8 台
  存储设备: 1 项
  基础设施: 4 项

【成本汇总】
  初始投资: ¥1,750,300
  硬件成本: ¥1,302,300
  软件成本: ¥374,000
  实施服务: ¥74,000
  年度运营: ¥112,260
  三年TCO: ¥2,087,080
```

## 🔧 技术实现

### 后端计算引擎
- **文件**: `deployment_predictor.py`
- **功能**:
  - 业务需求分析
  - 架构设计（单主从/分片集群/分布式）
  - 设备选型和清单生成
  - 成本计算（硬件/软件/服务/运营）
  - 网络拓扑设计

### 前端展示
- **文件**: `templates/predict_v2.html`
- **功能**:
  - 表单输入（普通版/专业版）
  - 结果展示（卡片+表格）
  - 打印优化
  - 响应式设计

### 设备库
系统内置完整的设备目录：
- **服务器**: Dell PowerEdge R系列（R340/R440/R640/R740/R940）
- **交换机**: Cisco Nexus/Catalyst系列
- **防火墙**: Fortinet FortiGate
- **负载均衡**: F5 BIG-IP
- **路由器**: Cisco ASR
- **存储**: Samsung SSD（SATA/NVMe）

## 🎨 界面特性

### 表格样式
- 清晰的表头（紫色渐变背景）
- 悬停高亮效果
- 自动计算小计和总计
- 响应式布局

### 打印优化
- 自动隐藏导航和按钮
- 优化表格字体大小
- 避免分页断行
- 黑白打印友好

## 📝 后续优化计划

### 短期（1-2周）
- [ ] Excel导出功能
- [ ] PDF导出功能
- [ ] 架构图可视化
- [ ] 网络拓扑图

### 中期（1个月）
- [ ] 自定义设备库
- [ ] 多方案对比
- [ ] 成本优化建议
- [ ] 历史方案保存

### 长期（3个月）
- [ ] AI智能推荐
- [ ] 实时价格更新
- [ ] 供应商对接
- [ ] 项目管理集成

## 🚀 快速测试

### 命令行测试
```bash
# 测试预测接口
curl -X POST http://127.0.0.1:5173/api/predict \
  -H 'Content-Type: application/json' \
  -d '{
    "total_data_size_gb": 500,
    "qps": 2000,
    "tps": 600,
    "concurrent_connections": 200,
    "need_high_availability": true
  }'

# 查看服务器清单
curl -s -X POST http://127.0.0.1:5173/api/predict \
  -H 'Content-Type: application/json' \
  -d '{"total_data_size_gb":500,"qps":2000,"tps":600}' | \
  python3 -c "import sys,json; [print(s['id'], s['role'], s['model']) for s in json.load(sys.stdin)['data']['equipment_list']['servers']]"
```

### 浏览器测试
1. 打开 http://127.0.0.1:5173/predict
2. 选择"普通版"
3. 填写参数：
   - 数据规模：500 GB
   - QPS：2000
   - TPS：600
   - 并发连接：200
   - 勾选"需要高可用"
4. 点击"开始预测"
5. 查看完整的配置清单和报价单

## 💡 使用建议

1. **准确填写参数**：业务参数越准确，预测结果越精确
2. **考虑增长空间**：建议预留30-50%的性能冗余
3. **关注TCO**：不仅看初始投资，更要关注三年总成本
4. **打印保存**：使用浏览器打印功能保存PDF版本
5. **多方案对比**：尝试不同参数组合，选择最优方案

## 📞 技术支持

如有问题或建议，请联系开发团队。

---

**更新日期**: 2025-10-27  
**版本**: v4.2  
**状态**: ✅ 已完成并测试通过
