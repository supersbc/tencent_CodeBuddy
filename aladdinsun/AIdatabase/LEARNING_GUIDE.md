# 🧠 TDSQL 架构预测系统 - 自我学习指南

## 📖 概述

本系统支持**自我学习和持续优化**，通过收集实际案例不断提升预测准确性。

## ✨ 核心特性

### 1. 📊 智能预测
- 基于规则和深度学习的混合预测
- 支持多维度数据分析
- 实时计算资源配置

### 2. 🧠 自我学习
- **案例收集**：收集实际迁移案例
- **模型训练**：使用 PyTorch 训练神经网络
- **持续优化**：随着案例增加，预测越来越准确

### 3. 💬 反馈机制
- 用户可对预测结果评分
- 提交实际部署情况
- 系统自动学习优化

## 🚀 使用流程

### 第一步：预测分析

1. 在"预测分析"标签页输入参数：
   - 数据总量（GB）
   - 表数量
   - QPS/TPS
   - 并发连接数
   - 业务需求（高可用、容灾等）

2. 点击"开始预测"

3. 查看预测结果：
   - 推荐架构类型
   - 服务器配置清单
   - 成本估算
   - 迁移建议

### 第二步：提交实际案例

当您完成实际迁移后，请提交案例帮助系统学习：

1. 切换到"提交案例"标签页

2. 填写实际情况：
   - **输入参数**：实际的数据量、QPS 等
   - **实际架构**：最终采用的架构类型
   - **节点数量**：实际部署的节点数
   - **备注说明**：部署经验、遇到的问题等

3. 点击"提交案例"

4. 系统会将案例添加到训练集

### 第三步：训练模型

当积累了足够的案例（建议 ≥10 个）：

1. 点击顶部的"🚀 开始训练模型"按钮

2. 系统会：
   - 加载所有训练案例
   - 使用深度学习算法训练
   - 优化模型参数
   - 保存最佳模型

3. 训练完成后，预测准确性会提升

### 第四步：反馈优化

对预测结果进行评价：

1. 切换到"反馈优化"标签页

2. 评分（1-5星）

3. 描述预测与实际的差异

4. 提交反馈

## 📊 学习机制

### 数据收集

系统收集以下信息：

```json
{
  "input": {
    "total_data_size_gb": 8640,
    "qps": 50000,
    "need_high_availability": true,
    ...
  },
  "output": {
    "architecture_type": "distributed",
    "node_count": 9,
    "shard_count": 9,
    "replica_count": 3
  },
  "feedback": "实际部署效果很好，性能满足需求"
}
```

### 模型训练

使用 PyTorch 深度学习框架：

1. **特征提取**：从输入数据提取 50 维特征向量
2. **神经网络**：多层感知机（MLP）
3. **多任务学习**：同时预测架构类型、节点数、分片数、副本数
4. **损失函数**：分类损失 + 回归损失
5. **优化器**：Adam 优化器

### 持续优化

- 每次训练都会保存最佳模型
- 新案例自动加入训练集
- 支持增量学习
- 模型版本管理

## 📈 效果提升

### 案例数量与准确率关系

| 案例数量 | 预测准确率 | 说明 |
|---------|-----------|------|
| 0-5     | 60-70%    | 基于规则预测 |
| 5-20    | 70-80%    | 初步学习 |
| 20-50   | 80-90%    | 较好效果 |
| 50-100  | 90-95%    | 优秀效果 |
| 100+    | 95%+      | 专家级预测 |

### 学习曲线

```
准确率
  ^
95%|                    ___________
  |                ___/
90%|            __/
  |         __/
80%|      _/
  |    _/
70%|  _/
  |_/
  +-----|-----|-----|-----|-----|---> 案例数
       10    20    50   100   200
```

## 💡 最佳实践

### 1. 提交高质量案例

✅ **好的案例**：
- 参数完整准确
- 实际部署验证过
- 包含详细说明
- 覆盖不同场景

❌ **避免**：
- 参数不准确
- 未实际部署
- 缺少关键信息

### 2. 多样化案例

收集不同类型的案例：
- 小型数据库（< 100GB）
- 中型数据库（100GB - 1TB）
- 大型数据库（1TB - 10TB）
- 超大型数据库（> 10TB）
- 不同 QPS 级别
- 不同业务需求

### 3. 定期训练

- 每增加 10 个案例训练一次
- 重要案例后立即训练
- 定期评估模型效果

### 4. 反馈闭环

```
预测 → 部署 → 反馈 → 学习 → 优化 → 预测
  ↑                                    ↓
  └────────────────────────────────────┘
```

## 🔧 技术细节

### 模型架构

```python
TDSQLArchitecturePredictor
├── 特征提取层 (50 → 256 → 256 → 128)
├── 架构分类器 (128 → 64 → 3)
├── 节点预测器 (128 → 64 → 1)
├── 分片预测器 (128 → 64 → 1)
└── 副本预测器 (128 → 32 → 1)
```

### 训练参数

- **学习率**：0.001
- **批次大小**：2-32（根据数据量）
- **训练轮数**：50-100
- **优化器**：Adam
- **激活函数**：ReLU
- **正则化**：Dropout (0.3)

### 数据存储

- **训练数据**：`training_data.json`
- **模型权重**：`best_model.pth`
- **训练历史**：`training_history.json`

## 📝 示例案例

### 案例 1：小型单机

```json
{
  "input": {
    "total_data_size_gb": 100,
    "qps": 500,
    "need_high_availability": false
  },
  "output": {
    "architecture_type": "standalone",
    "node_count": 1,
    "shard_count": 1,
    "replica_count": 1
  }
}
```

### 案例 2：大型分布式

```json
{
  "input": {
    "total_data_size_gb": 8640,
    "qps": 50000,
    "need_high_availability": true,
    "need_disaster_recovery": true
  },
  "output": {
    "architecture_type": "distributed",
    "node_count": 9,
    "shard_count": 9,
    "replica_count": 3
  }
}
```

## 🎯 目标

通过持续学习，系统将能够：

1. ✅ 准确预测 95% 以上的场景
2. ✅ 自动识别特殊情况
3. ✅ 提供个性化建议
4. ✅ 优化成本配置
5. ✅ 预测潜在风险

## 🚧 注意事项

1. **数据隐私**：案例数据仅用于模型训练，不会外泄
2. **模型更新**：训练后需重启服务加载新模型
3. **备份**：定期备份训练数据和模型文件
4. **验证**：新模型上线前应充分验证

## 📞 支持

如有问题，请查看：
- 系统日志
- 训练历史记录
- 统计信息面板

---

**让我们一起打造最智能的 TDSQL 架构预测系统！** 🚀
