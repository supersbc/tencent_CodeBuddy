<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç®€å•é¢„æµ‹æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .btn {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background: #5568d3;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ğŸ” é¢„æµ‹åŠŸèƒ½è°ƒè¯•æµ‹è¯•</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•APIè°ƒç”¨å’Œæ•°æ®è§£æ</p>
    
    <button class="btn" onclick="testPredict()">ğŸš€ æµ‹è¯•é¢„æµ‹</button>
    <button class="btn" onclick="testPredictWithXinChuan()">ğŸ‡¨ğŸ‡³ æµ‹è¯•ä¿¡åˆ›é¢„æµ‹</button>
    
    <div id="result"></div>
    
    <script>
        async function testPredict() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'æ­£åœ¨è°ƒç”¨API...';
            resultDiv.className = '';
            
            const data = {
                total_data_size_gb: 1000,
                qps: 5000,
                concurrent_users: 200,
                enable_xinchuan: false
            };
            
            try {
                console.log('å‘é€è¯·æ±‚:', data);
                
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”å¤´:', response.headers);
                
                const text = await response.text();
                console.log('å“åº”æ–‡æœ¬é•¿åº¦:', text.length);
                console.log('å“åº”æ–‡æœ¬å‰500å­—ç¬¦:', text.substring(0, 500));
                
                let result;
                try {
                    result = JSON.parse(text);
                } catch (e) {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `JSONè§£æå¤±è´¥:\n${e.message}\n\nå“åº”å†…å®¹:\n${text.substring(0, 1000)}`;
                    return;
                }
                
                console.log('è§£æç»“æœ:', result);
                
                if (result.success) {
                    resultDiv.className = 'success';
                    const data = result.data;
                    resultDiv.textContent = `âœ… é¢„æµ‹æˆåŠŸ!\n\n` +
                        `åŒ…å«å­—æ®µ:\n` +
                        `- architecture: ${!!data.architecture}\n` +
                        `- equipment_list: ${!!data.equipment_list} (ç±»å‹: ${Array.isArray(data.equipment_list) ? 'Array' : typeof data.equipment_list})\n` +
                        `- cost_breakdown: ${!!data.cost_breakdown}\n` +
                        `- xinchuan_enabled: ${data.xinchuan_enabled}\n` +
                        `- traditional_solution: ${!!data.traditional_solution}\n` +
                        `- xinchuan_solution: ${!!data.xinchuan_solution}\n\n` +
                        `equipment_list é•¿åº¦: ${data.equipment_list ? data.equipment_list.length : 0}\n\n` +
                        `å®Œæ•´æ•°æ®é”®: ${Object.keys(data).join(', ')}`;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `âŒ é¢„æµ‹å¤±è´¥:\n${result.error}`;
                }
            } catch (error) {
                console.error('é”™è¯¯:', error);
                resultDiv.className = 'error';
                resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}\n\nå †æ ˆ:\n${error.stack}`;
            }
        }
        
        async function testPredictWithXinChuan() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = 'æ­£åœ¨è°ƒç”¨APIï¼ˆä¿¡åˆ›æ¨¡å¼ï¼‰...';
            resultDiv.className = '';
            
            const data = {
                total_data_size_gb: 1000,
                qps: 5000,
                concurrent_users: 200,
                enable_xinchuan: true,
                xinchuan_mode: 'standard'
            };
            
            try {
                console.log('å‘é€è¯·æ±‚ï¼ˆä¿¡åˆ›ï¼‰:', data);
                
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                
                const text = await response.text();
                console.log('å“åº”æ–‡æœ¬é•¿åº¦:', text.length);
                
                let result;
                try {
                    result = JSON.parse(text);
                } catch (e) {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `JSONè§£æå¤±è´¥:\n${e.message}\n\nå¯èƒ½çš„é—®é¢˜å­—ç¬¦ä½ç½®: ${e.message.match(/\d+/)?.[0]}`;
                    console.error('JSONè§£æé”™è¯¯:', e);
                    console.error('é—®é¢˜ä½ç½®é™„è¿‘çš„æ–‡æœ¬:', text.substring(Math.max(0, parseInt(e.message.match(/\d+/)?.[0] || 0) - 100), parseInt(e.message.match(/\d+/)?.[0] || 0) + 100));
                    return;
                }
                
                console.log('è§£ææˆåŠŸ');
                
                if (result.success) {
                    resultDiv.className = 'success';
                    const data = result.data;
                    resultDiv.textContent = `âœ… é¢„æµ‹æˆåŠŸï¼ˆä¿¡åˆ›æ¨¡å¼ï¼‰!\n\n` +
                        `åŒ…å«å­—æ®µ:\n` +
                        `- xinchuan_enabled: ${data.xinchuan_enabled}\n` +
                        `- xinchuan_mode: ${data.xinchuan_mode}\n` +
                        `- traditional_solution: ${!!data.traditional_solution}\n` +
                        `- xinchuan_solution: ${!!data.xinchuan_solution}\n` +
                        `- cost_comparison: ${!!data.cost_comparison}\n\n` +
                        `traditional_solution è®¾å¤‡æ•°: ${data.traditional_solution?.equipment_list?.length || 0}\n` +
                        `xinchuan_solution è®¾å¤‡æ•°: ${data.xinchuan_solution?.equipment_list?.length || 0}\n\n` +
                        `æˆæœ¬å¯¹æ¯”:\n` +
                        `- ä¼ ç»Ÿæˆæœ¬: Â¥${data.cost_comparison?.traditional_cost || 0}\n` +
                        `- ä¿¡åˆ›æˆæœ¬: Â¥${data.cost_comparison?.xinchuan_cost || 0}\n` +
                        `- èŠ‚çº¦: Â¥${data.cost_comparison?.cost_savings || 0} (${data.cost_comparison?.savings_percent || 0}%)`;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `âŒ é¢„æµ‹å¤±è´¥:\n${result.error}`;
                }
            } catch (error) {
                console.error('é”™è¯¯:', error);
                resultDiv.className = 'error';
                resultDiv.textContent = `âŒ è¯·æ±‚å¤±è´¥:\n${error.message}\n\nå †æ ˆ:\n${error.stack}`;
            }
        }
    </script>
</body>
</html>
