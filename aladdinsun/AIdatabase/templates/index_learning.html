<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDSQL æ¶æ„æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ - è‡ªæˆ‘å­¦ä¹ ç‰ˆ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .learning-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        .learning-section h2 {
            color: white;
            margin-bottom: 15px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-box {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        .feedback-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }
        .case-form {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .train-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .train-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }
        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 24px;
            background: #e9ecef;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .tab.active {
            background: white;
            font-weight: 600;
            color: #667eea;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .back-nav-btn {
            display: inline-block;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .back-nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-nav-btn">â† è¿”å›å¯¼èˆª</a>
        <header class="header">
            <h1>ğŸ§  TDSQL æ¶æ„æ™ºèƒ½é¢„æµ‹ç³»ç»Ÿ</h1>
            <p class="subtitle">æ”¯æŒè‡ªæˆ‘å­¦ä¹ å’ŒæŒç»­ä¼˜åŒ–çš„æ·±åº¦å­¦ä¹ ç³»ç»Ÿ</p>
            <div style="margin-top: 15px;">
                <a href="/model_library" style="display: inline-block; background: #667eea; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 600;">
                    ğŸ“š æ¨¡å‹åº“ç®¡ç†
                </a>
            </div>
        </header>

        <div class="main-content">
            <!-- å­¦ä¹ ç»Ÿè®¡åŒºåŸŸ -->
            <div class="learning-section">
                <h2>ğŸ“Š å­¦ä¹ ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-number" id="totalCases">0</span>
                        <span class="stat-label">è®­ç»ƒæ¡ˆä¾‹</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="trainedCases">0</span>
                        <span class="stat-label">å·²è®­ç»ƒ</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="modelAccuracy">--</span>
                        <span class="stat-label">é¢„æµ‹å‡†ç¡®ç‡</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-number" id="lastTraining">æœªè®­ç»ƒ</span>
                        <span class="stat-label">æœ€åè®­ç»ƒ</span>
                    </div>
                </div>
                <button class="train-btn" onclick="trainModel()" style="margin-top: 20px;">
                    ğŸš€ å¼€å§‹è®­ç»ƒæ¨¡å‹
                </button>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tab-container">
                <button class="tab active" onclick="switchTab('predict')">ğŸ“Š é¢„æµ‹åˆ†æ</button>
                <button class="tab" onclick="switchTab('submit')">ğŸ“ æäº¤æ¡ˆä¾‹</button>
                <button class="tab" onclick="switchTab('feedback')">ğŸ’¬ åé¦ˆä¼˜åŒ–</button>
            </div>

            <!-- é¢„æµ‹åˆ†ææ ‡ç­¾é¡µ -->
            <div id="predictTab" class="tab-content active">
                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 20px;">
                    <h2 style="color: white; margin-bottom: 15px;">ğŸ“¤ æ™ºèƒ½è¯†åˆ«ä¸Šä¼ </h2>
                    <p style="opacity: 0.9; margin-bottom: 20px;">ä¸Šä¼ æˆªå›¾æˆ–Excelæ–‡ä»¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¯†åˆ«å¹¶å¡«å……è¡¨å•</p>
                    
                    <div style="display: flex; gap: 20px; align-items: center;">
                        <div style="flex: 1;">
                            <input type="file" id="fileUpload" accept="image/*,.xlsx,.xls" style="display: none;" onchange="handleFileUpload(event)">
                            <button onclick="document.getElementById('fileUpload').click()" class="btn" style="background: white; color: #667eea; width: 100%; padding: 15px; font-size: 16px; font-weight: 600;">
                                ğŸ“ é€‰æ‹©æ–‡ä»¶ï¼ˆå›¾ç‰‡/Excelï¼‰
                            </button>
                        </div>
                        <div style="flex: 1; background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; text-align: center;">
                            <div id="uploadStatus">æœªé€‰æ‹©æ–‡ä»¶</div>
                        </div>
                    </div>
                    
                    <div id="previewSection" style="margin-top: 20px; display: none;">
                        <img id="imagePreview" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    </div>
                </div>

                <div class="manual-input-section">
                    <h2>âœï¸ è¾“å…¥æ•°æ®åº“å‚æ•°</h2>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>æ•°æ®æ€»é‡ (GB)</label>
                            <input type="number" id="dataSizeInput" placeholder="ä¾‹å¦‚: 8640">
                        </div>
                        <div class="input-group">
                            <label>è¡¨æ•°é‡</label>
                            <input type="number" id="tableCountInput" placeholder="ä¾‹å¦‚: 150">
                        </div>
                        <div class="input-group">
                            <label>QPS</label>
                            <input type="number" id="qpsInput" placeholder="ä¾‹å¦‚: 50000">
                        </div>
                        <div class="input-group">
                            <label>TPS</label>
                            <input type="number" id="tpsInput" placeholder="ä¾‹å¦‚: 20000">
                        </div>
                        <div class="input-group">
                            <label>å¹¶å‘è¿æ¥æ•°</label>
                            <input type="number" id="connectionsInput" placeholder="ä¾‹å¦‚: 5000">
                        </div>
                        <div class="input-group">
                            <label>æ•°æ®å¢é•¿ç‡ (%/å¹´)</label>
                            <input type="number" id="growthRateInput" placeholder="ä¾‹å¦‚: 30">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="haCheckbox" checked> éœ€è¦é«˜å¯ç”¨</label>
                        <label><input type="checkbox" id="drCheckbox"> éœ€è¦å®¹ç¾</label>
                        <label><input type="checkbox" id="rwSplitCheckbox" checked> éœ€è¦è¯»å†™åˆ†ç¦»</label>
                    </div>
                    <button id="manualAnalyzeBtn" class="btn btn-secondary" onclick="analyzeManualInput()">
                        ğŸ“ å¼€å§‹é¢„æµ‹
                    </button>
                </div>

                <!-- ç»“æœå±•ç¤º -->
                <div id="resultSection" class="result-section" style="display: none;">
                    <h2>ğŸ“‹ é¢„æµ‹ç»“æœ</h2>
                    <div class="result-card">
                        <h3>ğŸ—ï¸ æ¨èæ¶æ„</h3>
                        <div id="architectureResult"></div>
                    </div>
                    <div class="result-card">
                        <h3>ğŸ–¥ï¸ æœåŠ¡å™¨æ¸…å•</h3>
                        <div id="serverResult"></div>
                    </div>
                    <div class="result-card" id="networkResultCard" style="display: none;">
                        <div id="networkResult"></div>
                    </div>
                    <div class="result-card" id="storageResultCard" style="display: none;">
                        <div id="storageResult"></div>
                    </div>
                    <div class="result-card" id="infrastructureResultCard" style="display: none;">
                        <div id="infrastructureResult"></div>
                    </div>
                    <div class="result-card">
                        <h3>ğŸ’° æˆæœ¬ä¼°ç®—</h3>
                        <div id="costResult"></div>
                    </div>
                </div>
            </div>

            <!-- æäº¤æ¡ˆä¾‹æ ‡ç­¾é¡µ -->
            <div id="submitTab" class="tab-content">
                <div class="feedback-section">
                    <h2>ğŸ“ æäº¤å®é™…æ¡ˆä¾‹</h2>
                    <p>æäº¤æ‚¨çš„å®é™…è¿ç§»æ¡ˆä¾‹ï¼Œå¸®åŠ©ç³»ç»Ÿå­¦ä¹ å’Œä¼˜åŒ–</p>
                    
                    <!-- æ¡ˆä¾‹æ–‡ä»¶ä¸Šä¼  -->
                    <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="color: white; margin-bottom: 10px;">ğŸ“¤ å¿«é€Ÿä¸Šä¼ æ¡ˆä¾‹</h3>
                        <p style="opacity: 0.9; margin-bottom: 15px; font-size: 14px;">ä¸Šä¼ åŒ…å«å®é™…éƒ¨ç½²æ•°æ®çš„æˆªå›¾æˆ–Excelæ–‡ä»¶</p>
                        <div style="display: flex; gap: 15px;">
                            <input type="file" id="caseFileUpload" accept="image/*,.xlsx,.xls" style="display: none;" onchange="handleCaseFileUpload(event)">
                            <button onclick="document.getElementById('caseFileUpload').click()" class="btn" style="background: white; color: #28a745; flex: 1; padding: 12px; font-weight: 600;">
                                ğŸ“ é€‰æ‹©æ¡ˆä¾‹æ–‡ä»¶
                            </button>
                            <div id="caseUploadStatus" style="flex: 1; background: rgba(255,255,255,0.2); padding: 12px; border-radius: 8px; text-align: center; font-size: 14px;">
                                æœªé€‰æ‹©æ–‡ä»¶
                            </div>
                        </div>
                    </div>
                    
                    <div class="case-form">
                        <h3>è¾“å…¥å‚æ•°</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>æ•°æ®æ€»é‡ (GB)</label>
                                <input type="number" id="caseDataSize" placeholder="å®é™…æ•°æ®é‡">
                            </div>
                            <div class="input-group">
                                <label>QPS</label>
                                <input type="number" id="caseQPS" placeholder="å®é™… QPS">
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 20px;">å®é™…æ¶æ„</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>æ¶æ„ç±»å‹</label>
                                <select id="caseArchType" class="input-group input">
                                    <option value="standalone">å•æœºæ¶æ„</option>
                                    <option value="distributed">åˆ†å¸ƒå¼æ¶æ„</option>
                                    <option value="hybrid">æ··åˆæ¶æ„</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>èŠ‚ç‚¹æ•°é‡</label>
                                <input type="number" id="caseNodeCount" placeholder="å®é™…èŠ‚ç‚¹æ•°">
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label>å¤‡æ³¨è¯´æ˜</label>
                            <textarea id="caseFeedback" rows="3" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;" placeholder="æè¿°å®é™…éƒ¨ç½²æƒ…å†µã€é‡åˆ°çš„é—®é¢˜ç­‰..."></textarea>
                        </div>
                        
                        <button class="btn btn-primary" onclick="submitCase()" style="margin-top: 20px;">
                            âœ… æäº¤æ¡ˆä¾‹
                        </button>
                    </div>
                </div>
            </div>

            <!-- åé¦ˆä¼˜åŒ–æ ‡ç­¾é¡µ -->
            <div id="feedbackTab" class="tab-content">
                <div class="feedback-section">
                    <h2>ğŸ’¬ é¢„æµ‹åé¦ˆ</h2>
                    <p>å¯¹é¢„æµ‹ç»“æœè¿›è¡Œè¯„ä»·ï¼Œå¸®åŠ©ç³»ç»ŸæŒç»­ä¼˜åŒ–</p>
                    
                    <div class="case-form">
                        <div class="input-group">
                            <label>é¢„æµ‹å‡†ç¡®æ€§è¯„åˆ†</label>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn" onclick="setRating(1)">â­</button>
                                <button class="btn" onclick="setRating(2)">â­â­</button>
                                <button class="btn" onclick="setRating(3)">â­â­â­</button>
                                <button class="btn" onclick="setRating(4)">â­â­â­â­</button>
                                <button class="btn" onclick="setRating(5)">â­â­â­â­â­</button>
                            </div>
                            <input type="hidden" id="feedbackRating" value="5">
                        </div>
                        
                        <div class="input-group" style="margin-top: 20px;">
                            <label>åé¦ˆæ„è§</label>
                            <textarea id="feedbackComment" rows="4" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;" placeholder="è¯·æè¿°é¢„æµ‹ç»“æœä¸å®é™…æƒ…å†µçš„å·®å¼‚..."></textarea>
                        </div>
                        
                        <button class="btn btn-success" onclick="submitFeedback()" style="margin-top: 20px;">
                            ğŸ“¤ æäº¤åé¦ˆ
                        </button>
                    </div>
                </div>
            </div>

            <!-- åŠ è½½åŠ¨ç”» -->
            <div id="loadingSection" class="loading-section" style="display: none;">
                <div class="spinner"></div>
                <p id="loadingText">æ­£åœ¨å¤„ç†ä¸­...</p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='enhanced_display.js') }}"></script>
    <script src="{{ url_for('static', filename='script_learning.js') }}"></script>
</body>
</html>
