<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDSQL éƒ¨ç½²èµ„æºé¢„æµ‹ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .input-section {
            padding: 40px;
            background: linear-gradient(to bottom, #f8f9fa, white);
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: white;
            margin-bottom: 30px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #764ba2;
            background: #f8f9fa;
        }

        .file-upload-area.dragover {
            border-color: #764ba2;
            background: #f0f0ff;
        }

        .upload-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9em;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .file-info {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input.auto-filled {
            background: #fff3cd;
            border-color: #ffc107;
            animation: highlight 2s ease;
        }

        @keyframes highlight {
            0%, 100% { background: white; }
            50% { background: #fff3cd; }
        }

        .form-group .hint {
            font-size: 0.85em;
            color: #999;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .results-section {
            padding: 40px;
            background: #f8f9fa;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .result-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .summary-card .label {
            font-size: 0.9em;
            color: #999;
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 2em;
            font-weight: 700;
            color: #333;
        }

        .summary-card .unit {
            font-size: 0.9em;
            color: #666;
            margin-left: 5px;
        }

        .equipment-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .equipment-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .equipment-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .equipment-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .equipment-table tr:hover {
            background: #f8f9fa;
        }

        .cost-breakdown {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cost-item.total {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            border-top: 2px solid #667eea;
            border-bottom: none;
            margin-top: 10px;
            padding-top: 15px;
        }

        .architecture-diagram {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .recommendations {
            display: grid;
            gap: 15px;
        }

        .recommendation-card {
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .recommendation-card.high {
            border-left-color: #f44336;
        }

        .recommendation-card.medium {
            border-left-color: #ff9800;
        }

        .recommendation-card .title {
            font-weight: 600;
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #333;
        }

        .recommendation-card .category {
            display: inline-block;
            padding: 4px 12px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .network-topology {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .topology-layer {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .topology-layer .layer-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }

        .topology-layer .devices {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .device-tag {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #e0e0e0;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
        .back-nav-btn {
            display: inline-block;
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .back-nav-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(-5px);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-nav-btn">â† è¿”å›å¯¼èˆª</a>
        <div class="header">
            <h1>ğŸš€ TDSQL éƒ¨ç½²èµ„æºé¢„æµ‹ç³»ç»Ÿ</h1>
            <p>æ™ºèƒ½åˆ†æä¸šåŠ¡éœ€æ±‚ï¼Œç²¾å‡†é¢„æµ‹éƒ¨ç½²èµ„æº</p>
        </div>

        <div class="main-card">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section">
                <h2 class="section-title">ğŸ“‹ ä¸šåŠ¡å‚æ•°é…ç½®</h2>

                <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
                <div class="file-upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </div>
                    <div class="upload-hint">æ”¯æŒ Excelã€JSONã€å›¾ç‰‡ã€PDF ç­‰æ ¼å¼ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æå–å‚æ•°</div>
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.json,.png,.jpg,.jpeg,.gif,.bmp,.pdf,.txt">
                </div>
                
                <!-- å·²ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯ -->
                <div id="uploadedFileInfo" style="display: none; background: #e8f5e9; border: 1px solid #4caf50; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: bold; color: #2e7d32; margin-bottom: 5px;">âœ… æ–‡ä»¶å·²ä¸Šä¼ </div>
                            <div id="uploadedFileName" style="color: #666; font-size: 0.9em;"></div>
                        </div>
                        <button type="button" id="clearFileBtn" class="btn btn-secondary" style="padding: 8px 16px; font-size: 0.9em;">
                            <span>ğŸ—‘ï¸</span>
                            <span>æ¸…é™¤æ–‡ä»¶</span>
                        </button>
                    </div>
                </div>

                <div class="file-info" id="fileInfo">
                    <strong>âœ… æ–‡ä»¶å·²ä¸Šä¼ ï¼š</strong>
                    <span id="fileName"></span>
                    <div id="extractedParams" style="margin-top: 10px;"></div>
                </div>

                <!-- å‚æ•°è¡¨å• -->
                <form id="paramForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="qps">QPS (æ¯ç§’æŸ¥è¯¢æ•°) *</label>
                            <input type="number" id="qps" name="qps" required min="1" placeholder="ä¾‹å¦‚: 5000">
                            <span class="hint">ç³»ç»Ÿæ¯ç§’å¤„ç†çš„æŸ¥è¯¢è¯·æ±‚æ•°</span>
                        </div>

                        <div class="form-group">
                            <label for="tps">TPS (æ¯ç§’äº‹åŠ¡æ•°)</label>
                            <input type="number" id="tps" name="tps" min="1" placeholder="ä¾‹å¦‚: 1500">
                            <span class="hint">ç³»ç»Ÿæ¯ç§’å¤„ç†çš„äº‹åŠ¡æ•°ï¼Œé»˜è®¤ä¸ºQPSçš„30%</span>
                        </div>

                        <div class="form-group">
                            <label for="data_volume">æ•°æ®é‡ (GB) *</label>
                            <input type="number" id="data_volume" name="data_volume" required min="1" placeholder="ä¾‹å¦‚: 500">
                            <span class="hint">å½“å‰æ•°æ®æ€»é‡</span>
                        </div>

                        <div class="form-group">
                            <label for="concurrent_users">å¹¶å‘ç”¨æˆ·æ•°</label>
                            <input type="number" id="concurrent_users" name="concurrent_users" min="1" placeholder="ä¾‹å¦‚: 1000">
                            <span class="hint">åŒæ—¶åœ¨çº¿çš„ç”¨æˆ·æ•°é‡</span>
                        </div>

                        <div class="form-group">
                            <label for="data_growth_rate">æ•°æ®å¢é•¿ç‡ (å¹´)</label>
                            <input type="number" id="data_growth_rate" name="data_growth_rate" step="0.1" min="0" max="5" placeholder="ä¾‹å¦‚: 0.3">
                            <span class="hint">é¢„è®¡å¹´æ•°æ®å¢é•¿ç‡ï¼Œé»˜è®¤30%</span>
                        </div>

                        <div class="form-group">
                            <label for="ha_level">é«˜å¯ç”¨çº§åˆ« *</label>
                            <select id="ha_level" name="ha_level" required>
                                <option value="high">é«˜ - å¤šå‰¯æœ¬+å¼‚åœ°å®¹ç¾</option>
                                <option value="medium">ä¸­ - ä¸»ä»å¤åˆ¶</option>
                                <option value="low">ä½ - å•èŠ‚ç‚¹</option>
                            </select>
                            <span class="hint">ç³»ç»Ÿé«˜å¯ç”¨æ€§è¦æ±‚</span>
                        </div>

                        <div class="form-group">
                            <label for="industry">è¡Œä¸šç±»å‹</label>
                            <select id="industry" name="industry">
                                <option value="general">é€šç”¨</option>
                                <option value="finance">é‡‘è</option>
                                <option value="ecommerce">ç”µå•†</option>
                                <option value="gaming">æ¸¸æˆ</option>
                                <option value="social">ç¤¾äº¤</option>
                                <option value="iot">ç‰©è”ç½‘</option>
                                <option value="government">æ”¿åŠ¡</option>
                                <option value="healthcare">åŒ»ç–—</option>
                                <option value="education">æ•™è‚²</option>
                            </select>
                            <span class="hint">ä¸šåŠ¡æ‰€å±è¡Œä¸š</span>
                        </div>

                        <div class="form-group">
                            <label for="peak_qps">å³°å€¼QPS</label>
                            <input type="number" id="peak_qps" name="peak_qps" min="1" placeholder="è‡ªåŠ¨è®¡ç®—">
                            <span class="hint">ä¸šåŠ¡é«˜å³°æœŸQPSï¼Œé»˜è®¤ä¸ºå¹³å‡QPSçš„1.5å€</span>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary" id="predictBtn">
                            <span>ğŸ”®</span>
                            <span>å¼€å§‹é¢„æµ‹</span>
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <span>ğŸ”„</span>
                            <span>é‡ç½®è¡¨å•</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- ç»“æœåŒºåŸŸ -->
            <div class="results-section" id="resultsSection">
                <h2 class="section-title">ğŸ“Š é¢„æµ‹ç»“æœ</h2>

                <div class="result-tabs">
                    <button class="tab active" data-tab="summary">æ¦‚è§ˆ</button>
                    <button class="tab" data-tab="architecture">æ¶æ„è®¾è®¡</button>
                    <button class="tab" data-tab="equipment">è®¾å¤‡æ¸…å•</button>
                    <button class="tab" data-tab="network">ç½‘ç»œæ‹“æ‰‘</button>
                    <button class="tab" data-tab="cost">æˆæœ¬åˆ†æ</button>
                    <button class="tab" data-tab="diagram">æ¶æ„å›¾</button>
                    <button class="tab" data-tab="recommendations">éƒ¨ç½²å»ºè®®</button>
                </div>

                <!-- æ¦‚è§ˆæ ‡ç­¾é¡µ -->
                <div class="tab-content active" id="summary">
                    <div class="summary-cards" id="summaryCards"></div>
                </div>

                <!-- æ¶æ„è®¾è®¡æ ‡ç­¾é¡µ -->
                <div class="tab-content" id="architecture">
                    <div id="architectureContent"></div>
                </div>

                <!-- è®¾å¤‡æ¸…å•æ ‡ç­¾é¡µ -->
                <div class="tab-content" id="equipment">
                    <div id="equipmentContent"></div>
                </div>

                <!-- ç½‘ç»œæ‹“æ‰‘æ ‡ç­¾é¡µ -->
                <div class="tab-content" id="network">
                    <div class="network-topology" id="networkContent"></div>
                </div>

                <!-- æˆæœ¬åˆ†ææ ‡ç­¾é¡µ -->
                <div class="tab-content" id="cost">
                    <div class="cost-breakdown" id="costContent"></div>
                </div>

                <!-- æ¶æ„å›¾æ ‡ç­¾é¡µ -->
                <div class="tab-content" id="diagram">
                    <div class="architecture-diagram" id="diagramContent">
                        <canvas id="architectureCanvas"></canvas>
                    </div>
                </div>

                <!-- éƒ¨ç½²å»ºè®®æ ‡ç­¾é¡µ -->
                <div class="tab-content" id="recommendations">
                    <div class="recommendations" id="recommendationsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentResult = null;
        let uploadedFile = null;

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadedFileInfo = document.getElementById('uploadedFileInfo');
        const uploadedFileName = document.getElementById('uploadedFileName');
        const clearFileBtn = document.getElementById('clearFileBtn');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        // æ¸…é™¤æ–‡ä»¶æŒ‰é’®
        clearFileBtn.addEventListener('click', () => {
            clearUploadedFile();
        });

        function clearUploadedFile() {
            // æ¸…é™¤æ–‡ä»¶è¾“å…¥
            fileInput.value = '';
            uploadedFile = null;
            
            // éšè—æ–‡ä»¶ä¿¡æ¯
            uploadedFileInfo.style.display = 'none';
            
            // æ¸…ç©ºè¡¨å•ï¼ˆå¯é€‰ï¼‰
            if (confirm('æ˜¯å¦åŒæ—¶æ¸…ç©ºè¡¨å•ä¸­çš„å‚æ•°ï¼Ÿ')) {
                document.getElementById('paramForm').reset();
            }
        }

        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            // æ˜¾ç¤ºä¸Šä¼ ä¸­çŠ¶æ€
            uploadArea.style.opacity = '0.5';
            uploadArea.style.pointerEvents = 'none';

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    uploadedFile = file;
                    
                    // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                    uploadedFileName.textContent = `æ–‡ä»¶å: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                    uploadedFileInfo.style.display = 'block';
                    
                    // è‡ªåŠ¨å¡«å……è¡¨å•
                    if (result.params) {
                        fillFormWithData(result.params);
                        
                        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                        const paramCount = Object.keys(result.params).filter(k => !k.startsWith('error') && !k.startsWith('info')).length;
                        if (paramCount > 0) {
                            alert(`âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼å·²è‡ªåŠ¨æå– ${paramCount} ä¸ªå‚æ•°`);
                        } else if (result.params.error) {
                            alert(`âš ï¸ æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œä½†è§£æå¤±è´¥ï¼š${result.params.error}`);
                        } else if (result.params.info) {
                            alert(`â„¹ï¸ ${result.params.info}\n${result.params.message || ''}\n${result.params.suggestion || ''}`);
                        }
                    }
                } else {
                    alert('æ–‡ä»¶å¤„ç†å¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                alert('æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
            } finally {
                // æ¢å¤ä¸Šä¼ åŒºåŸŸçŠ¶æ€
                uploadArea.style.opacity = '1';
                uploadArea.style.pointerEvents = 'auto';
            }
        }

        function fillFormWithData(data) {
            // å‚æ•°æ˜ å°„
            const mapping = {
                'qps': 'qps',
                'tps': 'tps',
                'data_volume': 'data_volume',
                'concurrent_users': 'concurrent_users',
                'data_growth_rate': 'data_growth_rate',
                'ha_level': 'ha_level',
                'industry': 'industry',
                'peak_qps': 'peak_qps'
            };

            Object.entries(mapping).forEach(([key, formField]) => {
                if (data[key] !== undefined && data[key] !== null) {
                    const input = document.getElementById(formField);
                    if (input) {
                        input.value = data[key];
                        input.classList.add('auto-filled');
                        setTimeout(() => input.classList.remove('auto-filled'), 2000);
                    }
                }
            });
        }

        // è¡¨å•æäº¤
        document.getElementById('paramForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = {};
            
            formData.forEach((value, key) => {
                if (value) {
                    // æ•°å­—ç±»å‹è½¬æ¢
                    if (['qps', 'tps', 'data_volume', 'concurrent_users', 'peak_qps'].includes(key)) {
                        data[key] = parseInt(value);
                    } else if (key === 'data_growth_rate') {
                        data[key] = parseFloat(value);
                    } else {
                        data[key] = value;
                    }
                }
            });

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const predictBtn = document.getElementById('predictBtn');
            const originalText = predictBtn.innerHTML;
            predictBtn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; border-width: 2px;"></div><span>é¢„æµ‹ä¸­...</span>';
            predictBtn.disabled = true;

            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    // APIè¿”å›çš„æ•°æ®åœ¨result.dataä¸­
                    currentResult = result.data;
                    displayResults(result.data);
                } else {
                    alert('é¢„æµ‹å¤±è´¥ï¼š' + result.error);
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            } finally {
                predictBtn.innerHTML = originalText;
                predictBtn.disabled = false;
            }
        });

        // æ˜¾ç¤ºç»“æœ
        function displayResults(result) {
            document.getElementById('resultsSection').classList.add('show');
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

            // æ˜¾ç¤ºæ¦‚è§ˆ
            displaySummary(result);
            
            // æ˜¾ç¤ºæ¶æ„è®¾è®¡
            displayArchitecture(result.architecture);
            
            // æ˜¾ç¤ºè®¾å¤‡æ¸…å•
            displayEquipment(result.equipment_list);
            
            // æ˜¾ç¤ºç½‘ç»œæ‹“æ‰‘
            displayNetworkTopology(result.network_topology);
            
            // æ˜¾ç¤ºæˆæœ¬åˆ†æ
            displayCost(result.cost_breakdown);
            
            // æ˜¾ç¤ºæ¶æ„å›¾
            displayDiagram(result.architecture_diagram);
            
            // æ˜¾ç¤ºå»ºè®®
            displayRecommendations(result.recommendations);
        }

        function displaySummary(result) {
            const summaryCards = document.getElementById('summaryCards');
            const summary = result.input_summary;
            const cost = result.cost_breakdown.summary;

            summaryCards.innerHTML = `
                <div class="summary-card">
                    <div class="label">ç³»ç»Ÿè§„æ¨¡</div>
                    <div class="value">${summary.scale.toUpperCase()}</div>
                </div>
                <div class="summary-card">
                    <div class="label">QPS</div>
                    <div class="value">${summary.qps.toLocaleString()}<span class="unit">æ¬¡/ç§’</span></div>
                </div>
                <div class="summary-card">
                    <div class="label">æ•°æ®é‡</div>
                    <div class="value">${summary.current_data_gb.toLocaleString()}<span class="unit">GB</span></div>
                </div>
                <div class="summary-card">
                    <div class="label">æœåŠ¡å™¨æ•°é‡</div>
                    <div class="value">${result.equipment_list.servers.length}<span class="unit">å°</span></div>
                </div>
                <div class="summary-card">
                    <div class="label">åˆå§‹æŠ•èµ„</div>
                    <div class="value">Â¥${(cost.initial_investment / 10000).toFixed(1)}<span class="unit">ä¸‡</span></div>
                </div>
                <div class="summary-card">
                    <div class="label">3å¹´TCO</div>
                    <div class="value">Â¥${(cost.three_year_tco / 10000).toFixed(1)}<span class="unit">ä¸‡</span></div>
                </div>
            `;
        }

        function displayArchitecture(architecture) {
            const content = document.getElementById('architectureContent');
            const topology = architecture.topology;

            content.innerHTML = `
                <div class="equipment-table">
                    <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">æ¶æ„ç±»å‹</h3>
                    <div style="padding: 20px;">
                        <p style="font-size: 1.2em; margin-bottom: 10px;"><strong>${architecture.description}</strong></p>
                        <p style="color: #666;">ç±»å‹ï¼š${architecture.type}</p>
                    </div>
                </div>

                <div class="equipment-table" style="margin-top: 20px;">
                    <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">æ‹“æ‰‘é…ç½®</h3>
                    <table>
                        <tr>
                            <td><strong>åˆ†ç‰‡æ•°é‡</strong></td>
                            <td>${topology.shard_count}</td>
                        </tr>
                        <tr>
                            <td><strong>å‰¯æœ¬æ•°é‡</strong></td>
                            <td>${topology.replica_count}</td>
                        </tr>
                        <tr>
                            <td><strong>æ•°æ®åº“èŠ‚ç‚¹</strong></td>
                            <td>${topology.db_nodes} å°</td>
                        </tr>
                        <tr>
                            <td><strong>ä»£ç†èŠ‚ç‚¹</strong></td>
                            <td>${topology.proxy_nodes} å°</td>
                        </tr>
                        <tr>
                            <td><strong>åº”ç”¨èŠ‚ç‚¹</strong></td>
                            <td>${topology.app_nodes} å°</td>
                        </tr>
                        <tr>
                            <td><strong>ç›‘æ§èŠ‚ç‚¹</strong></td>
                            <td>${topology.monitor_nodes} å°</td>
                        </tr>
                        <tr>
                            <td><strong>å¤‡ä»½èŠ‚ç‚¹</strong></td>
                            <td>${topology.backup_nodes} å°</td>
                        </tr>
                    </table>
                </div>

                <div class="equipment-table" style="margin-top: 20px;">
                    <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">é«˜å¯ç”¨é…ç½®</h3>
                    <table>
                        <tr>
                            <td><strong>é«˜å¯ç”¨çº§åˆ«</strong></td>
                            <td>${architecture.ha_config.level}</td>
                        </tr>
                        <tr>
                            <td><strong>è‡ªåŠ¨æ•…éšœè½¬ç§»</strong></td>
                            <td>${architecture.ha_config.auto_failover ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}</td>
                        </tr>
                        <tr>
                            <td><strong>å¤‡ä»½ç­–ç•¥</strong></td>
                            <td>${architecture.ha_config.backup_strategy}</td>
                        </tr>
                        <tr>
                            <td><strong>å¼‚åœ°å®¹ç¾</strong></td>
                            <td>${architecture.ha_config.disaster_recovery ? 'âœ… å¯ç”¨' : 'âŒ ç¦ç”¨'}</td>
                        </tr>
                    </table>
                </div>
            `;
        }

        function displayEquipment(equipment) {
            const content = document.getElementById('equipmentContent');
            
            let html = '';

            // æœåŠ¡å™¨æ¸…å•
            if (equipment.servers && equipment.servers.length > 0) {
                html += `
                    <div class="equipment-table">
                        <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">æœåŠ¡å™¨æ¸…å•</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç¼–å·</th>
                                    <th>è§’è‰²</th>
                                    <th>å‹å·</th>
                                    <th>CPU</th>
                                    <th>å†…å­˜</th>
                                    <th>å­˜å‚¨</th>
                                    <th>ç½‘ç»œ</th>
                                    <th>å•ä»·(å…ƒ)</th>
                                    <th>åŠŸè€—(W)</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                equipment.servers.forEach(server => {
                    html += `
                        <tr>
                            <td>${server.id}</td>
                            <td>${server.role}</td>
                            <td>${server.model}</td>
                            <td>${server.cpu}</td>
                            <td>${server.memory}</td>
                            <td>${server.disk}</td>
                            <td>${server.network}</td>
                            <td>Â¥${server.unit_price.toLocaleString()}</td>
                            <td>${server.power_w}W</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // ç½‘ç»œè®¾å¤‡æ¸…å•
            if (equipment.network_devices && equipment.network_devices.length > 0) {
                html += `
                    <div class="equipment-table" style="margin-top: 20px;">
                        <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">ç½‘ç»œè®¾å¤‡æ¸…å•</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç¼–å·</th>
                                    <th>ç±»å‹</th>
                                    <th>å‹å·</th>
                                    <th>è§„æ ¼</th>
                                    <th>å•ä»·(å…ƒ)</th>
                                    <th>åŠŸè€—(W)</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                equipment.network_devices.forEach(device => {
                    html += `
                        <tr>
                            <td>${device.id}</td>
                            <td>${device.type}</td>
                            <td>${device.model}</td>
                            <td>${device.ports || device.throughput || '-'}</td>
                            <td>Â¥${device.unit_price.toLocaleString()}</td>
                            <td>${device.power_w}W</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // å­˜å‚¨è®¾å¤‡
            if (equipment.storage && equipment.storage.length > 0) {
                html += `
                    <div class="equipment-table" style="margin-top: 20px;">
                        <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">å­˜å‚¨è®¾å¤‡æ¸…å•</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç±»å‹</th>
                                    <th>å‹å·</th>
                                    <th>å®¹é‡(TB)</th>
                                    <th>IOPS</th>
                                    <th>ååé‡</th>
                                    <th>æ€»ä»·(å…ƒ)</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                equipment.storage.forEach(storage => {
                    html += `
                        <tr>
                            <td>${storage.type}</td>
                            <td>${storage.model}</td>
                            <td>${storage.capacity_tb}TB</td>
                            <td>${storage.iops.toLocaleString()}</td>
                            <td>${storage.throughput}</td>
                            <td>Â¥${storage.total_price.toLocaleString()}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            // åŸºç¡€è®¾æ–½
            if (equipment.infrastructure && equipment.infrastructure.length > 0) {
                html += `
                    <div class="equipment-table" style="margin-top: 20px;">
                        <h3 style="padding: 20px; margin: 0; background: #f8f9fa;">åŸºç¡€è®¾æ–½æ¸…å•</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>ç±»å‹</th>
                                    <th>æ•°é‡</th>
                                    <th>å•ä»·(å…ƒ)</th>
                                    <th>æ€»ä»·(å…ƒ)</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                equipment.infrastructure.forEach(item => {
                    html += `
                        <tr>
                            <td>${item.type}</td>
                            <td>${item.quantity || item.capacity_kw + 'kW' || '-'}</td>
                            <td>Â¥${item.unit_price.toLocaleString()}</td>
                            <td>Â¥${item.total_price.toLocaleString()}</td>
                        </tr>
                    `;
                });

                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            content.innerHTML = html;
        }

        function displayNetworkTopology(topology) {
            const content = document.getElementById('networkContent');
            
            let html = '<h3 style="margin-bottom: 20px;">ç½‘ç»œåˆ†å±‚æ¶æ„</h3>';

            topology.layers.forEach(layer => {
                html += `
                    <div class="topology-layer">
                        <div class="layer-name">${layer.name}</div>
                        <div style="color: #666; margin-bottom: 10px; font-size: 0.9em;">${layer.description}</div>
                        <div class="devices">
                            ${layer.devices.map(device => `<span class="device-tag">${device}</span>`).join('')}
                        </div>
                    </div>
                `;
            });

            html += '<h3 style="margin: 30px 0 20px;">VLANåˆ’åˆ†</h3>';
            html += '<div class="equipment-table"><table><thead><tr><th>VLAN ID</th><th>åç§°</th><th>å­ç½‘</th></tr></thead><tbody>';
            
            topology.vlans.forEach(vlan => {
                html += `
                    <tr>
                        <td>${vlan.id}</td>
                        <td>${vlan.name}</td>
                        <td>${vlan.subnet}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';

            content.innerHTML = html;
        }

        function displayCost(costBreakdown) {
            const content = document.getElementById('costContent');
            const summary = costBreakdown.summary;
            const breakdown = costBreakdown.breakdown;

            let html = `
                <h3 style="margin-bottom: 20px;">æˆæœ¬æ±‡æ€»</h3>
                <div class="cost-item total">
                    <span>åˆå§‹æŠ•èµ„æ€»é¢</span>
                    <span>Â¥${summary.initial_investment.toLocaleString()}</span>
                </div>
                <div class="cost-item total">
                    <span>3å¹´æ€»æ‹¥æœ‰æˆæœ¬(TCO)</span>
                    <span>Â¥${summary.three_year_tco.toLocaleString()}</span>
                </div>

                <h3 style="margin: 30px 0 20px;">ç¡¬ä»¶æˆæœ¬</h3>
                <div class="cost-item">
                    <span>æœåŠ¡å™¨</span>
                    <span>Â¥${breakdown.hardware.servers.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>ç½‘ç»œè®¾å¤‡</span>
                    <span>Â¥${breakdown.hardware.network_devices.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>å­˜å‚¨è®¾å¤‡</span>
                    <span>Â¥${breakdown.hardware.storage.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>åŸºç¡€è®¾æ–½</span>
                    <span>Â¥${breakdown.hardware.infrastructure.toLocaleString()}</span>
                </div>
                <div class="cost-item" style="font-weight: 600; background: #f8f9fa;">
                    <span>ç¡¬ä»¶å°è®¡</span>
                    <span>Â¥${summary.total_hardware.toLocaleString()}</span>
                </div>

                <h3 style="margin: 30px 0 20px;">è½¯ä»¶è®¸å¯è¯</h3>
                <div class="cost-item">
                    <span>TDSQLè®¸å¯è¯</span>
                    <span>Â¥${breakdown.software.tdsql_license.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>æ“ä½œç³»ç»Ÿè®¸å¯è¯</span>
                    <span>Â¥${breakdown.software.os_license.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>ç›‘æ§è½¯ä»¶</span>
                    <span>Â¥${breakdown.software.monitoring.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>å¤‡ä»½è½¯ä»¶</span>
                    <span>Â¥${breakdown.software.backup.toLocaleString()}</span>
                </div>
                <div class="cost-item" style="font-weight: 600; background: #f8f9fa;">
                    <span>è½¯ä»¶å°è®¡</span>
                    <span>Â¥${summary.total_software.toLocaleString()}</span>
                </div>

                <h3 style="margin: 30px 0 20px;">æœåŠ¡è´¹ç”¨</h3>
                <div class="cost-item">
                    <span>éƒ¨ç½²å®æ–½</span>
                    <span>Â¥${breakdown.services.deployment.toLocaleString()}</span>
                </div>
                <div class="cost-item">
                    <span>æŠ€æœ¯åŸ¹è®­</span>
                    <span>Â¥${breakdown.services.training.toLocaleString()}</span>
                </div>
                <div class="cost-item" style="font-weight: 600; background: #f8f9fa;">
                    <span>æœåŠ¡å°è®¡</span>
                    <span>Â¥${summary.total_services.toLocaleString()}</span>
                </div>

                <h3 style="margin: 30px 0 20px;">å¹´åº¦è¿è¥æˆæœ¬</h3>
                <div class="cost-item">
                    <span>ç”µè´¹</span>
                    <span>Â¥${breakdown.annual_operating.power.toLocaleString()}/å¹´</span>
                </div>
                <div class="cost-item">
                    <span>åˆ¶å†·è´¹ç”¨</span>
                    <span>Â¥${breakdown.annual_operating.cooling.toLocaleString()}/å¹´</span>
                </div>
                <div class="cost-item">
                    <span>è½¯ä»¶ç»´æŠ¤</span>
                    <span>Â¥${breakdown.annual_operating.maintenance.toLocaleString()}/å¹´</span>
                </div>
                <div class="cost-item" style="font-weight: 600; background: #f8f9fa;">
                    <span>å¹´åº¦è¿è¥å°è®¡</span>
                    <span>Â¥${summary.annual_operating.toLocaleString()}/å¹´</span>
                </div>
                <div class="cost-item" style="color: #666;">
                    <span>æœˆåº¦è¿è¥æˆæœ¬</span>
                    <span>Â¥${summary.monthly_operating.toLocaleString()}/æœˆ</span>
                </div>
            `;

            content.innerHTML = html;
        }

        function displayDiagram(diagram) {
            const content = document.getElementById('diagramContent');
            
            // ç®€åŒ–ç‰ˆæ¶æ„å›¾æ˜¾ç¤º
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h3 style="margin-bottom: 30px;">ç³»ç»Ÿæ¶æ„æ‹“æ‰‘å›¾</h3>
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 30px; max-width: 800px; margin: 0 auto;">
                        <p style="color: #666; margin-bottom: 20px;">æ¶æ„å›¾åŒ…å« ${diagram.nodes.length} ä¸ªèŠ‚ç‚¹ï¼Œ${diagram.links.length} æ¡è¿æ¥</p>
                        <div style="text-align: left; line-height: 2;">
                            <p><strong>èŠ‚ç‚¹ç±»å‹ï¼š</strong></p>
                            <ul style="list-style: none; padding-left: 20px;">
                                <li>ğŸŒ Internetæ¥å…¥</li>
                                <li>ğŸ”’ é˜²ç«å¢™ (åŒæœºçƒ­å¤‡)</li>
                                <li>âš–ï¸ è´Ÿè½½å‡è¡¡å™¨ (åŒæœºçƒ­å¤‡)</li>
                                <li>ğŸ”€ æ ¸å¿ƒäº¤æ¢æœº (åŒæœºçƒ­å¤‡)</li>
                                <li>ğŸ’» åº”ç”¨æœåŠ¡å™¨é›†ç¾¤</li>
                                <li>ğŸ”„ TDSQLä»£ç†èŠ‚ç‚¹</li>
                                <li>ğŸ—„ï¸ TDSQLæ•°æ®åº“é›†ç¾¤</li>
                                <li>ğŸ“Š ç›‘æ§å’Œå¤‡ä»½æœåŠ¡</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayRecommendations(recommendations) {
            const content = document.getElementById('recommendationsContent');
            
            let html = '';
            recommendations.forEach(rec => {
                html += `
                    <div class="recommendation-card ${rec.priority}">
                        <span class="category">${rec.category}</span>
                        <div class="title">${rec.title}</div>
                        <div style="color: #666;">${rec.description}</div>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        // æ ‡ç­¾é¡µåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰activeç±»
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // æ·»åŠ activeç±»
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
    </script>
</body>
</html>
