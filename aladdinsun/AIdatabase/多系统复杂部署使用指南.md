# 多系统复杂部署架构预测使用指南

## 📚 目录

1. [功能概述](#功能概述)
2. [支持的文件格式](#支持的文件格式)
3. [多系统环境识别](#多系统环境识别)
4. [复杂部署拓扑](#复杂部署拓扑)
5. [输入参数详解](#输入参数详解)
6. [输出结果详解](#输出结果详解)
7. [使用示例](#使用示例)

---

## 🎯 功能概述

### 新增核心功能

✅ **多格式文件智能识别**
- Excel文件（.xlsx, .xls, .xlsm）
- PDF文档（.pdf）
- 图片文件（.png, .jpg, .jpeg, .bmp）
- 文本文件（.txt, .csv, .json）

✅ **多系统环境智能分析**
- 自动识别大环境内的多个系统
- 智能提取每个系统的参数
- 自动计算整体统计数据
- 系统间依赖关系分析

✅ **复杂部署拓扑支持**
- 单中心部署
- 同城双中心/多中心
- 两地三中心
- 三地五中心
- 多地多中心
- 全球分布式

✅ **详细的输入输出参数**
- 150+ 输入参数
- 100+ 输出参数
- 完整的架构方案
- 详细的成本估算
- 风险评估和优化建议

---

## 📁 支持的文件格式

### 1. Excel文件（推荐）

#### 系统清单表格式

| 系统名称 | 系统类型 | 业务模块 | 数据量(GB) | 表数量 | QPS | TPS | 峰值QPS | 连接数 | 可用性要求 | 数据敏感度 | 备份要求 | 备注 |
|---------|---------|---------|-----------|--------|-----|-----|---------|--------|-----------|-----------|---------|------|
| 订单系统 | 核心 | 订单管理 | 5000 | 200 | 50000 | 10000 | 80000 | 2000 | 99.99% | 高 | 实时 | 双11高峰 |
| 用户系统 | 核心 | 用户管理 | 2000 | 100 | 30000 | 5000 | 50000 | 1000 | 99.99% | 高 | 每日 | - |
| 商品系统 | 核心 | 商品管理 | 3000 | 150 | 40000 | 8000 | 60000 | 1500 | 99.95% | 中 | 每日 | - |

#### 部署架构表格式

| 配置项 | 值 |
|--------|-----|
| 部署模式 | 两地三中心 |
| 主中心区域 | 上海 |
| 同城备中心 | 上海二区 |
| 异地备中心 | 北京 |
| 容灾类型 | 双活 |
| 同步方式 | 半同步+异步 |
| RPO | 0秒 |
| RTO | 60秒 |
| 网络类型 | 专线 |
| 同城带宽 | 10Gbps |
| 异地带宽 | 1Gbps |

#### 汇总信息表格式

| 指标 | 值 |
|------|-----|
| 系统总数 | 3 |
| 总数据量 | 10TB |
| 总QPS | 120000 |
| 总TPS | 23000 |
| 总连接数 | 4500 |
| 行业 | 电商平台 |
| 预算级别 | 高 |

### 2. PDF文档

系统会自动提取PDF中的：
- 文本内容
- 表格数据
- 部署架构描述
- 技术指标

### 3. 图片文件

支持OCR识别：
- 架构图
- 表格截图
- 手写笔记
- 白板照片

### 4. 文本/JSON文件

支持结构化数据：
```json
{
  "environment_name": "电商平台生产环境",
  "total_systems": 3,
  "systems": [
    {
      "system_name": "订单系统",
      "system_type": "核心",
      "data_size_gb": 5000,
      "qps": 50000,
      "tps": 10000
    }
  ],
  "deployment": {
    "deployment_mode": "两地三中心",
    "disaster_recovery_type": "双活"
  }
}
```

---

## 🏢 多系统环境识别

### 系统分类

#### 1. 核心系统
- 业务关键系统
- 高可用性要求（99.99%+）
- 实时备份
- 优先级最高

#### 2. 辅助系统
- 支撑业务系统
- 中等可用性要求（99.9%+）
- 每日备份
- 优先级中等

#### 3. 外围系统
- 非关键系统
- 基础可用性要求（99%+）
- 定期备份
- 优先级较低

### 自动识别功能

系统会自动识别：
- ✅ 系统名称和类型
- ✅ 业务模块归属
- ✅ 数据量和表数量
- ✅ 性能指标（QPS/TPS）
- ✅ 可用性要求
- ✅ 数据敏感度
- ✅ 备份策略

### 整体统计

自动计算：
- 📊 系统总数
- 📊 总数据量（TB）
- 📊 总QPS/TPS
- 📊 总连接数
- 📊 最大单系统QPS
- 📊 平均QPS

---

## 🏗️ 复杂部署拓扑

### 1. 单中心部署

```
┌─────────────────┐
│   主数据中心     │
│   ┌─────────┐   │
│   │  主库   │   │
│   └─────────┘   │
│   ┌─────────┐   │
│   │  从库   │   │
│   └─────────┘   │
└─────────────────┘
```

**适用场景**：
- 小规模应用
- 可用性要求不高（99%-99.9%）
- 预算有限

**特点**：
- RPO: 1小时
- RTO: 2小时
- 成本最低

### 2. 同城双中心

```
┌─────────────────┐     专线     ┌─────────────────┐
│  主数据中心      │◄──────────►│  备数据中心      │
│  ┌─────────┐    │   10Gbps    │  ┌─────────┐    │
│  │  主库   │    │   延迟2ms   │  │  备库   │    │
│  └─────────┘    │             │  └─────────┘    │
│  上海一区        │             │  上海二区        │
└─────────────────┘             └─────────────────┘
```

**适用场景**：
- 中等规模应用
- 可用性要求高（99.95%+）
- 需要同城容灾

**特点**：
- RPO: 0秒（实时同步）
- RTO: 5分钟
- 同城延迟低（<5ms）

### 3. 两地三中心 ⭐推荐

```
        上海（主中心）
┌─────────────────────────────┐
│  ┌─────────┐   ┌─────────┐  │
│  │ 主库    │   │ 同城备   │  │
│  │ 上海一区 │   │ 上海二区 │  │
│  └─────────┘   └─────────┘  │
└─────────────────────────────┘
         │ 专线
         │ 1Gbps
         │ 延迟30ms
         ▼
┌─────────────────┐
│  北京（异地备）  │
│  ┌─────────┐   │
│  │ 异地备   │   │
│  │ 北京一区 │   │
│  └─────────┘   │
└─────────────────┘
```

**适用场景**：
- 大规模应用
- 高可用性要求（99.99%+）
- 金融、电商等关键业务

**特点**：
- RPO: 0秒
- RTO: 1分钟
- 同城半同步 + 异地异步
- 支持双活

### 4. 三地五中心

```
     上海（双中心）          北京（双中心）
┌──────────────────┐    ┌──────────────────┐
│ ┌────┐  ┌────┐  │    │ ┌────┐  ┌────┐  │
│ │主库│  │备库│  │◄──►│ │主库│  │备库│  │
│ └────┘  └────┘  │    │ └────┘  └────┘  │
└──────────────────┘    └──────────────────┘
         │                      │
         └──────────┬───────────┘
                    │
            ┌───────────────┐
            │  深圳（备中心）│
            │   ┌────┐      │
            │   │备库│      │
            │   └────┘      │
            └───────────────┘
```

**适用场景**：
- 超大规模应用
- 极高可用性要求（99.995%+）
- 全国性业务

**特点**：
- RPO: 0秒
- RTO: 30秒
- 多活架构
- 最高可用性

### 5. 部署模式对比

| 部署模式 | 数据中心数 | RPO | RTO | 可用性 | 成本 | 适用场景 |
|---------|-----------|-----|-----|--------|------|---------|
| 单中心 | 1 | 1小时 | 2小时 | 99.9% | 低 | 小规模 |
| 同城双中心 | 2 | 0秒 | 5分钟 | 99.95% | 中 | 中等规模 |
| 两地三中心 | 3 | 0秒 | 1分钟 | 99.99% | 高 | 大规模 |
| 三地五中心 | 5 | 0秒 | 30秒 | 99.995% | 很高 | 超大规模 |

---

## 📝 输入参数详解

### 基础信息（必填）

| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| project_name | 字符串 | 项目名称 | "电商平台数据库架构" |
| environment_name | 字符串 | 环境名称 | "生产环境" |
| total_systems | 整数 | 系统总数 | 3 |
| industry | 字符串 | 行业类型 | "电商平台" |

### 系统列表（必填）

每个系统包含：

```python
{
    "system_name": "订单系统",           # 系统名称
    "system_type": "核心",              # 系统类型
    "business_module": "订单管理",      # 业务模块
    "data_size_gb": 5000,              # 数据量(GB)
    "table_count": 200,                # 表数量
    "qps": 50000,                      # QPS
    "tps": 10000,                      # TPS
    "peak_qps": 80000,                 # 峰值QPS
    "connections": 2000,               # 连接数
    "availability_requirement": "99.99%",  # 可用性要求
    "data_sensitivity": "高",          # 数据敏感度
    "backup_requirement": "实时",      # 备份要求
    "notes": "双11高峰"                # 备注
}
```

### 部署拓扑参数

#### 部署模式
- `deployment_mode`: 单中心、同城双中心、同城多中心、两地三中心、三地五中心

#### 同城部署
- `same_city_centers`: 同城中心数量
- `same_city_distance_km`: 同城距离（公里）
- `same_city_network_latency_ms`: 同城网络延迟（毫秒）
- `same_city_bandwidth_mbps`: 同城带宽（Mbps）

#### 异地部署
- `remote_centers`: 异地中心数量
- `remote_regions`: 异地区域列表
- `remote_distance_km`: 异地距离（公里）
- `remote_network_latency_ms`: 异地网络延迟（毫秒）
- `remote_bandwidth_mbps`: 异地带宽（Mbps）

#### 容灾配置
- `disaster_recovery_type`: 冷备、温备、热备、主备、双活、多活
- `sync_mode`: 异步、半同步、同步、强同步
- `rpo_seconds`: RPO（秒）
- `rto_seconds`: RTO（秒）
- `auto_failover`: 是否自动故障切换
- `failover_time_seconds`: 故障切换时间（秒）

### 性能要求

- `avg_response_time_ms`: 平均响应时间（毫秒）
- `p95_response_time_ms`: P95响应时间（毫秒）
- `p99_response_time_ms`: P99响应时间（毫秒）
- `max_response_time_ms`: 最大响应时间（毫秒）

### 扩展性

- `horizontal_scaling`: 是否支持水平扩展
- `vertical_scaling`: 是否支持垂直扩展
- `auto_scaling`: 是否支持自动伸缩
- `max_scale_out_nodes`: 最大扩展节点数

---

## 📤 输出结果详解

### 1. 架构方案

```json
{
  "architecture_name": "两地三中心双活架构",
  "architecture_type": "分布式",
  "deployment_mode": "两地三中心",
  "total_instances": 6
}
```

### 2. 数据库实例列表

每个实例包含：
- 实例ID和名称
- 实例类型（主/从/只读/灾备）
- 规格（CPU、内存、存储）
- 位置（区域、可用区）
- 性能预估（QPS/TPS）

### 3. 分片配置

```json
{
  "enable_sharding": true,
  "database_sharding": true,
  "database_count": 8,
  "table_sharding": true,
  "table_count_per_db": 256,
  "sharding_algorithm": "hash"
}
```

### 4. 读写分离配置

```json
{
  "enable_read_write_split": true,
  "readonly_instance_count": 3,
  "load_balance_algorithm": "加权轮询",
  "max_replication_delay_ms": 100
}
```

### 5. 高可用配置

```json
{
  "ha_mode": "MGR",
  "auto_failover": true,
  "failover_time_seconds": 60,
  "vip_enabled": true
}
```

### 6. 性能优化建议

```json
{
  "enable_redis_cache": true,
  "redis_cache_size_gb": 128,
  "connection_pool_size": 500,
  "slow_query_threshold_ms": 100
}
```

### 7. 成本估算

```json
{
  "server_cost_monthly": 50000,
  "storage_cost_monthly": 20000,
  "network_cost_monthly": 10000,
  "total_cost_monthly": 80000,
  "total_cost_yearly": 960000
}
```

### 8. 风险评估

```json
[
  {
    "risk_type": "性能风险",
    "risk_level": "中",
    "description": "峰值QPS可能超过预估容量",
    "mitigation": "建议增加只读实例或启用缓存"
  }
]
```

### 9. 优化建议

```json
[
  {
    "category": "性能优化",
    "recommendation": "启用Redis缓存，缓存热点数据",
    "priority": "高",
    "expected_benefit": "降低数据库负载50%"
  }
]
```

---

## 💡 使用示例

### 示例1：电商平台三系统架构

#### 输入文件（Excel）

**系统清单表**：

| 系统名称 | 系统类型 | 数据量(GB) | QPS | TPS | 可用性 |
|---------|---------|-----------|-----|-----|--------|
| 订单系统 | 核心 | 5000 | 50000 | 10000 | 99.99% |
| 用户系统 | 核心 | 2000 | 30000 | 5000 | 99.99% |
| 商品系统 | 核心 | 3000 | 40000 | 8000 | 99.95% |

**部署架构表**：

| 配置项 | 值 |
|--------|-----|
| 部署模式 | 两地三中心 |
| 容灾类型 | 双活 |
| RPO | 0秒 |
| RTO | 60秒 |

#### 输出结果

```
✅ 推荐架构：两地三中心双活架构

📊 实例配置：
- 上海主中心：3个主实例 + 3个从实例
- 上海备中心：3个备实例
- 北京备中心：3个备实例
- 总计：12个实例

🔧 分片配置：
- 订单系统：8库256表
- 用户系统：4库128表
- 商品系统：4库128表

📈 性能预估：
- 总QPS：120000
- 总TPS：23000
- 平均响应时间：50ms
- P99响应时间：200ms

💰 成本估算：
- 月成本：¥80,000
- 年成本：¥960,000

⚠️  风险提示：
- 双11峰值QPS可能达到200000，建议预留50%容量
- 建议启用Redis缓存降低数据库压力

🎯 优化建议：
1. 启用Redis缓存（128GB）
2. 配置读写分离（每系统3个只读实例）
3. 启用自动扩缩容
4. 配置慢查询监控
```

### 示例2：金融核心系统

#### 输入

```json
{
  "project_name": "银行核心系统",
  "total_systems": 5,
  "systems": [
    {
      "system_name": "账户系统",
      "system_type": "核心",
      "data_size_gb": 10000,
      "qps": 100000,
      "availability_requirement": "99.995%"
    },
    {
      "system_name": "交易系统",
      "system_type": "核心",
      "data_size_gb": 20000,
      "qps": 150000,
      "availability_requirement": "99.995%"
    }
  ],
  "deployment_mode": "三地五中心",
  "disaster_recovery_type": "多活",
  "industry": "银行"
}
```

#### 输出

```
✅ 推荐架构：三地五中心多活架构

📊 数据中心分布：
- 上海主中心 + 上海备中心
- 北京主中心 + 北京备中心
- 深圳备中心

🔧 复制拓扑：
- 上海 ←→ 北京：强同步复制
- 上海 → 深圳：异步复制
- 北京 → 深圳：异步复制

📈 性能指标：
- 可用性：99.995%
- RPO：0秒
- RTO：30秒
- 年停机时间：<26分钟

💰 成本估算：
- 月成本：¥500,000
- 年成本：¥6,000,000

✅ 合规性：
- 满足银监会两地三中心要求
- 满足等保三级要求
- 支持数据驻留要求
```

---

## 🚀 快速开始

### 1. 准备文件

选择以下任一方式：
- ✅ Excel文件（推荐）
- ✅ PDF文档
- ✅ 图片截图
- ✅ JSON文件

### 2. 上传文件

访问系统界面，上传文件

### 3. 查看结果

系统自动：
- 识别多个系统
- 提取参数
- 推荐架构
- 估算成本

### 4. 导出报告

支持导出：
- PDF报告
- Excel表格
- JSON数据
- 架构图

---

## 📞 技术支持

如有问题，请查看：
- 📖 详细文档：`专业参数说明文档.md`
- 🎯 快速开始：`快速开始-专业参数使用.md`
- 📊 功能清单：`功能清单.md`

---

**系统版本**: v2.0  
**更新日期**: 2025-01-25  
**支持**: 多系统环境 + 复杂部署拓扑
