# 🎉 TDSQL 部署资源预测系统 - 部署完成

## ✅ 已完成的配置

### 1. 端口配置
- ✅ **Flask 应用端口**：18080（5位数）
- ✅ **Nginx 反向代理端口**：80（HTTP 默认端口）
- ✅ **监听地址**：0.0.0.0（允许外部访问）

### 2. Nginx 反向代理
- ✅ 已安装并配置 Nginx
- ✅ 配置文件：`/etc/nginx/conf.d/tdsql.conf`
- ✅ 自动将 80 端口请求转发到 18080 端口
- ✅ 支持 WebSocket 和长连接

### 3. 服务状态
- ✅ Flask 应用：正常运行（PID: 12690）
- ✅ Nginx 服务：正常运行（PID: 15805）
- ✅ 端口监听：80 和 18080 都正常

## 🌐 访问地址

### 主要访问方式（无需端口号）
```
http://aladdinsun.devcloud.woa.com
```

### 备用访问方式
```
http://21.91.205.22
http://aladdinsun-23thglr84a.devcloud.woa.com
```

### 功能页面
- 主页面：`http://aladdinsun.devcloud.woa.com/`
- 导航页面：`http://aladdinsun.devcloud.woa.com/nav`
- 部署预测：`http://aladdinsun.devcloud.woa.com/predict`
- 模型库管理：`http://aladdinsun.devcloud.woa.com/model_library`
- 学习系统：`http://aladdinsun.devcloud.woa.com/learning`

## 🔧 管理命令

### 启动所有服务
```bash
cd /data/workspace/tencent_CodeBuddy/aladdinsun/AIdatabase
bash start_with_nginx.sh
```

### 查看服务状态
```bash
# 查看 Flask 应用
ps aux | grep app_simple

# 查看 Nginx
ps aux | grep nginx

# 查看端口监听
ss -tlnp | grep -E ":(80|18080)"
```

### 查看日志
```bash
# Flask 应用日志
tail -f /data/workspace/tencent_CodeBuddy/aladdinsun/AIdatabase/app.log

# Nginx 访问日志
tail -f /var/log/nginx/tdsql_access.log

# Nginx 错误日志
tail -f /var/log/nginx/tdsql_error.log
```

### 重启服务
```bash
# 重启 Flask 应用
pkill -f app_simple.py
cd /data/workspace/tencent_CodeBuddy/aladdinsun/AIdatabase
nohup python3 app_simple.py > app.log 2>&1 &

# 重启 Nginx
nginx -s reload
# 或完全重启
pkill nginx && nginx
```

### 停止服务
```bash
# 停止 Flask 应用
pkill -f app_simple.py

# 停止 Nginx
pkill nginx
```

## 🔐 关于 HTTPS 加密

当前配置使用 HTTP（80 端口）。如需启用 HTTPS：

### 方法 1：在 AnyDev/iOA 层面配置
- 在 iOA 环境详情中查找 HTTPS 或证书配置选项
- 使用平台提供的默认证书

### 方法 2：在 Nginx 中配置 SSL
1. 申请证书：https://cam.it.woa.com/certificate/operate?type=1
2. 下载证书和密钥
3. 修改 Nginx 配置添加 SSL 支持
4. 监听 443 端口

## 📊 架构说明

```
外部请求
    ↓
http://aladdinsun.devcloud.woa.com (域名)
    ↓
Nginx (端口 80) - 反向代理
    ↓
Flask 应用 (端口 18080)
    ↓
返回响应
```

## 🎯 优势

1. ✅ **简洁的访问地址**：无需指定端口号
2. ✅ **标准 HTTP 端口**：使用 80 端口，符合 Web 标准
3. ✅ **反向代理保护**：Nginx 提供额外的安全层
4. ✅ **易于扩展**：可以轻松添加 HTTPS、负载均衡等功能
5. ✅ **日志分离**：Nginx 和 Flask 日志独立，便于排查问题

## 📝 注意事项

1. **容器重启**：如果容器重启，需要手动运行 `start_with_nginx.sh` 启动服务
2. **端口占用**：确保 80 和 18080 端口没有被其他程序占用
3. **日志管理**：定期清理日志文件，避免占用过多磁盘空间
4. **性能优化**：如果访问量大，可以调整 Nginx 的 worker 进程数

## 🎊 部署成功！

你的 TDSQL 部署资源预测系统现在可以通过简洁的域名直接访问了！

访问地址：**http://aladdinsun.devcloud.woa.com**

祝使用愉快！🚀
