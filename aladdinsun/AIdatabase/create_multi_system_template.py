#!/usr/bin/env python3
"""
åˆ›å»ºå¤šç³»ç»Ÿç¯å¢ƒExcelæ¨¡æ¿
åŒ…å«ç³»ç»Ÿæ¸…å•ã€éƒ¨ç½²æ¶æ„ã€æ±‡æ€»ä¿¡æ¯ç­‰å¤šä¸ªå·¥ä½œè¡¨
"""

import pandas as pd
from openpyxl import Workbook
from openpyxl.styles import Font, PatternFill, Alignment, Border, Side
from openpyxl.utils.dataframe import dataframe_to_rows
from datetime import datetime


def create_multi_system_template(filename: str = "å¤šç³»ç»Ÿç¯å¢ƒæ¨¡æ¿.xlsx"):
    """åˆ›å»ºå¤šç³»ç»Ÿç¯å¢ƒExcelæ¨¡æ¿"""
    
    wb = Workbook()
    
    # åˆ é™¤é»˜è®¤å·¥ä½œè¡¨
    if 'Sheet' in wb.sheetnames:
        wb.remove(wb['Sheet'])
    
    # ========== 1. ç³»ç»Ÿæ¸…å•è¡¨ ==========
    ws_systems = wb.create_sheet("ç³»ç»Ÿæ¸…å•", 0)
    
    # è¡¨å¤´
    headers_systems = [
        "ç³»ç»Ÿåç§°", "ç³»ç»Ÿç±»å‹", "ä¸šåŠ¡æ¨¡å—", "æ•°æ®é‡(GB)", "è¡¨æ•°é‡",
        "QPS", "TPS", "å³°å€¼QPS", "è¿æ¥æ•°", "å¯ç”¨æ€§è¦æ±‚",
        "æ•°æ®æ•æ„Ÿåº¦", "å¤‡ä»½è¦æ±‚", "å¤‡æ³¨"
    ]
    
    # ç¤ºä¾‹æ•°æ®
    data_systems = [
        ["è®¢å•ç³»ç»Ÿ", "æ ¸å¿ƒ", "è®¢å•ç®¡ç†", 5000, 200, 50000, 10000, 80000, 2000, "99.99%", "é«˜", "å®æ—¶", "åŒ11é«˜å³°"],
        ["ç”¨æˆ·ç³»ç»Ÿ", "æ ¸å¿ƒ", "ç”¨æˆ·ç®¡ç†", 2000, 100, 30000, 5000, 50000, 1000, "99.99%", "é«˜", "æ¯æ—¥", ""],
        ["å•†å“ç³»ç»Ÿ", "æ ¸å¿ƒ", "å•†å“ç®¡ç†", 3000, 150, 40000, 8000, 60000, 1500, "99.95%", "ä¸­", "æ¯æ—¥", ""],
        ["æ”¯ä»˜ç³»ç»Ÿ", "æ ¸å¿ƒ", "æ”¯ä»˜å¤„ç†", 1000, 50, 20000, 15000, 30000, 500, "99.99%", "é«˜", "å®æ—¶", "é‡‘èçº§"],
        ["åº“å­˜ç³»ç»Ÿ", "è¾…åŠ©", "åº“å­˜ç®¡ç†", 500, 30, 10000, 3000, 15000, 300, "99.9%", "ä¸­", "æ¯æ—¥", ""],
        ["æ—¥å¿—ç³»ç»Ÿ", "å¤–å›´", "æ—¥å¿—æ”¶é›†", 10000, 10, 5000, 1000, 8000, 200, "99%", "ä½", "æ¯å‘¨", ""],
    ]
    
    # å†™å…¥è¡¨å¤´
    ws_systems.append(headers_systems)
    
    # å†™å…¥æ•°æ®
    for row in data_systems:
        ws_systems.append(row)
    
    # è®¾ç½®æ ·å¼
    _style_worksheet(ws_systems, headers_systems)
    
    # ========== 2. éƒ¨ç½²æ¶æ„è¡¨ ==========
    ws_deployment = wb.create_sheet("éƒ¨ç½²æ¶æ„", 1)
    
    deployment_data = [
        ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"],
        ["éƒ¨ç½²æ¨¡å¼", "ä¸¤åœ°ä¸‰ä¸­å¿ƒ", "å•ä¸­å¿ƒ/åŒåŸåŒä¸­å¿ƒ/åŒåŸå¤šä¸­å¿ƒ/ä¸¤åœ°ä¸‰ä¸­å¿ƒ/ä¸‰åœ°äº”ä¸­å¿ƒ"],
        ["ä¸»ä¸­å¿ƒåŒºåŸŸ", "ä¸Šæµ·", "ä¸»æ•°æ®ä¸­å¿ƒæ‰€åœ¨åŒºåŸŸ"],
        ["ä¸»ä¸­å¿ƒå¯ç”¨åŒº", "ä¸Šæµ·ä¸€åŒº", ""],
        ["åŒåŸå¤‡ä¸­å¿ƒåŒºåŸŸ", "ä¸Šæµ·", "åŒåŸå¤‡ä»½ä¸­å¿ƒ"],
        ["åŒåŸå¤‡ä¸­å¿ƒå¯ç”¨åŒº", "ä¸Šæµ·äºŒåŒº", ""],
        ["å¼‚åœ°å¤‡ä¸­å¿ƒåŒºåŸŸ", "åŒ—äº¬", "å¼‚åœ°å¤‡ä»½ä¸­å¿ƒ"],
        ["å¼‚åœ°å¤‡ä¸­å¿ƒå¯ç”¨åŒº", "åŒ—äº¬ä¸€åŒº", ""],
        ["", "", ""],
        ["å®¹ç¾ç±»å‹", "åŒæ´»", "å†·å¤‡/æ¸©å¤‡/çƒ­å¤‡/ä¸»å¤‡/åŒæ´»/å¤šæ´»"],
        ["åŒæ­¥æ–¹å¼", "åŠåŒæ­¥+å¼‚æ­¥", "åŒåŸåŠåŒæ­¥ï¼Œå¼‚åœ°å¼‚æ­¥"],
        ["RPO(ç§’)", "0", "æ¢å¤ç‚¹ç›®æ ‡"],
        ["RTO(ç§’)", "60", "æ¢å¤æ—¶é—´ç›®æ ‡"],
        ["è‡ªåŠ¨æ•…éšœåˆ‡æ¢", "æ˜¯", "æ˜¯/å¦"],
        ["æ•…éšœåˆ‡æ¢æ—¶é—´(ç§’)", "60", ""],
        ["", "", ""],
        ["ç½‘ç»œç±»å‹", "ä¸“çº¿", "ä¸“çº¿/VPN/å…¬ç½‘/äº‘ä¸“çº¿"],
        ["åŒåŸç½‘ç»œå¸¦å®½(Mbps)", "10000", "10Gbps"],
        ["åŒåŸç½‘ç»œå»¶è¿Ÿ(ms)", "2", ""],
        ["åŒåŸè·ç¦»(km)", "30", ""],
        ["å¼‚åœ°ç½‘ç»œå¸¦å®½(Mbps)", "1000", "1Gbps"],
        ["å¼‚åœ°ç½‘ç»œå»¶è¿Ÿ(ms)", "30", ""],
        ["å¼‚åœ°è·ç¦»(km)", "1200", "ä¸Šæµ·åˆ°åŒ—äº¬"],
        ["", "", ""],
        ["å¯ç”¨æ€§ç›®æ ‡", "99.99%", ""],
        ["å¹´åœæœºæ—¶é—´(åˆ†é’Ÿ)", "52.56", "è‡ªåŠ¨è®¡ç®—"],
    ]
    
    for row in deployment_data:
        ws_deployment.append(row)
    
    _style_worksheet(ws_deployment, ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"])
    
    # ========== 3. æ±‡æ€»ä¿¡æ¯è¡¨ ==========
    ws_summary = wb.create_sheet("æ±‡æ€»ä¿¡æ¯", 2)
    
    summary_data = [
        ["æŒ‡æ ‡", "å€¼", "è¯´æ˜"],
        ["é¡¹ç›®åç§°", "ç”µå•†å¹³å°æ•°æ®åº“æ¶æ„", ""],
        ["ç¯å¢ƒåç§°", "ç”Ÿäº§ç¯å¢ƒ", ""],
        ["æäº¤äºº", "", ""],
        ["æäº¤æ—¥æœŸ", datetime.now().strftime("%Y-%m-%d"), ""],
        ["", "", ""],
        ["ç³»ç»Ÿæ€»æ•°", "6", "è‡ªåŠ¨ç»Ÿè®¡"],
        ["æ ¸å¿ƒç³»ç»Ÿæ•°", "4", ""],
        ["è¾…åŠ©ç³»ç»Ÿæ•°", "1", ""],
        ["å¤–å›´ç³»ç»Ÿæ•°", "1", ""],
        ["", "", ""],
        ["æ€»æ•°æ®é‡(GB)", "21500", "è‡ªåŠ¨ç»Ÿè®¡"],
        ["æ€»æ•°æ®é‡(TB)", "21", ""],
        ["æ€»è¡¨æ•°é‡", "540", ""],
        ["", "", ""],
        ["æ€»QPS", "155000", "è‡ªåŠ¨ç»Ÿè®¡"],
        ["æ€»TPS", "42000", ""],
        ["æ€»è¿æ¥æ•°", "5500", ""],
        ["æœ€å¤§å•ç³»ç»ŸQPS", "50000", "è®¢å•ç³»ç»Ÿ"],
        ["å¹³å‡QPS", "25833", ""],
        ["", "", ""],
        ["è¡Œä¸šç±»å‹", "ç”µå•†å¹³å°", ""],
        ["ä¸šåŠ¡ç±»å‹", "OLTP", "OLTP/OLAP/HTAP"],
        ["ä¸šåŠ¡é«˜å³°æ—¶æ®µ", "20:00-22:00", ""],
        ["å­£èŠ‚æ€§é«˜å³°", "åŒ11ã€618", ""],
        ["å¹´å¢é•¿ç‡(%)", "50", ""],
        ["", "", ""],
        ["è¯»å†™æ¯”ä¾‹", "7:3", ""],
        ["è¯»QPS", "108500", ""],
        ["å†™QPS", "46500", ""],
        ["", "", ""],
        ["é¢„ç®—çº§åˆ«", "é«˜", "ä½/ä¸­/é«˜"],
        ["æœˆé¢„ç®—(å…ƒ)", "100000", ""],
        ["ä¼˜å…ˆäº‘æœåŠ¡", "æ˜¯", "æ˜¯/å¦"],
    ]
    
    for row in summary_data:
        ws_summary.append(row)
    
    _style_worksheet(ws_summary, ["æŒ‡æ ‡", "å€¼", "è¯´æ˜"])
    
    # ========== 4. æ€§èƒ½è¦æ±‚è¡¨ ==========
    ws_performance = wb.create_sheet("æ€§èƒ½è¦æ±‚", 3)
    
    performance_data = [
        ["æŒ‡æ ‡", "å€¼", "è¯´æ˜"],
        ["å¹³å‡å“åº”æ—¶é—´(ms)", "50", ""],
        ["P95å“åº”æ—¶é—´(ms)", "100", "95%è¯·æ±‚çš„å“åº”æ—¶é—´"],
        ["P99å“åº”æ—¶é—´(ms)", "200", "99%è¯·æ±‚çš„å“åº”æ—¶é—´"],
        ["æœ€å¤§å“åº”æ—¶é—´(ms)", "500", ""],
        ["", "", ""],
        ["æ…¢æŸ¥è¯¢é˜ˆå€¼(ms)", "100", ""],
        ["è¿æ¥è¶…æ—¶(ç§’)", "30", ""],
        ["æŸ¥è¯¢è¶…æ—¶(ç§’)", "60", ""],
        ["", "", ""],
        ["æ”¯æŒæ°´å¹³æ‰©å±•", "æ˜¯", "æ˜¯/å¦"],
        ["æ”¯æŒå‚ç›´æ‰©å±•", "æ˜¯", "æ˜¯/å¦"],
        ["æ”¯æŒè‡ªåŠ¨ä¼¸ç¼©", "æ˜¯", "æ˜¯/å¦"],
        ["æœ€å¤§æ‰©å±•èŠ‚ç‚¹æ•°", "32", ""],
    ]
    
    for row in performance_data:
        ws_performance.append(row)
    
    _style_worksheet(ws_performance, ["æŒ‡æ ‡", "å€¼", "è¯´æ˜"])
    
    # ========== 5. å®‰å…¨åˆè§„è¡¨ ==========
    ws_security = wb.create_sheet("å®‰å…¨åˆè§„", 4)
    
    security_data = [
        ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"],
        ["æ•°æ®é™æ€åŠ å¯†", "æ˜¯", "æ˜¯/å¦"],
        ["æ•°æ®ä¼ è¾“åŠ å¯†", "æ˜¯", "æ˜¯/å¦"],
        ["è®¿é—®æ§åˆ¶çº§åˆ«", "ä¸¥æ ¼", "åŸºç¡€/å¢å¼º/ä¸¥æ ¼"],
        ["å®¡è®¡æ—¥å¿—", "æ˜¯", "æ˜¯/å¦"],
        ["", "", ""],
        ["åˆè§„è¦æ±‚", "ç­‰ä¿ä¸‰çº§", "å¤šä¸ªç”¨é€—å·åˆ†éš”"],
        ["", "PCI-DSS", ""],
        ["", "GDPR", ""],
        ["æ•°æ®é©»ç•™è¦æ±‚", "ä¸­å›½å¤§é™†", ""],
        ["", "", ""],
        ["æ•°æ®æ•æ„Ÿåº¦", "é«˜", "ä½/ä¸­/é«˜"],
        ["ä¸ªäººä¿¡æ¯ä¿æŠ¤", "æ˜¯", "æ˜¯/å¦"],
        ["æ•°æ®è„±æ•", "æ˜¯", "æ˜¯/å¦"],
        ["", "", ""],
        ["å¤‡ä»½åŠ å¯†", "æ˜¯", "æ˜¯/å¦"],
        ["å¤‡ä»½å¼‚åœ°å­˜å‚¨", "æ˜¯", "æ˜¯/å¦"],
    ]
    
    for row in security_data:
        ws_security.append(row)
    
    _style_worksheet(ws_security, ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"])
    
    # ========== 6. å¤‡ä»½ç­–ç•¥è¡¨ ==========
    ws_backup = wb.create_sheet("å¤‡ä»½ç­–ç•¥", 5)
    
    backup_data = [
        ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"],
        ["å¤‡ä»½é¢‘ç‡", "æ¯æ—¥", "æ¯å°æ—¶/æ¯æ—¥/æ¯å‘¨"],
        ["å¤‡ä»½æ—¶é—´", "02:00", ""],
        ["å¤‡ä»½ä¿ç•™å¤©æ•°", "30", ""],
        ["å¤‡ä»½ç±»å‹", "å…¨é‡+å¢é‡", "å…¨é‡/å¢é‡/å…¨é‡+å¢é‡"],
        ["", "", ""],
        ["å…¨é‡å¤‡ä»½é¢‘ç‡", "æ¯å‘¨", ""],
        ["å…¨é‡å¤‡ä»½æ—¶é—´", "å‘¨æ—¥02:00", ""],
        ["å¢é‡å¤‡ä»½é¢‘ç‡", "æ¯æ—¥", ""],
        ["", "", ""],
        ["å¤‡ä»½ä½ç½®", "æœ¬åœ°+å¼‚åœ°", "æœ¬åœ°/å¼‚åœ°/äº‘ç«¯"],
        ["æœ¬åœ°å¤‡ä»½ä¿ç•™", "7å¤©", ""],
        ["å¼‚åœ°å¤‡ä»½ä¿ç•™", "30å¤©", ""],
        ["", "", ""],
        ["å¤‡ä»½éªŒè¯", "æ˜¯", "æ˜¯/å¦"],
        ["éªŒè¯é¢‘ç‡", "æ¯å‘¨", ""],
        ["æ¢å¤æ¼”ç»ƒ", "æ˜¯", "æ˜¯/å¦"],
        ["æ¼”ç»ƒé¢‘ç‡", "æ¯å­£åº¦", ""],
    ]
    
    for row in backup_data:
        ws_backup.append(row)
    
    _style_worksheet(ws_backup, ["é…ç½®é¡¹", "å€¼", "è¯´æ˜"])
    
    # ========== 7. ä½¿ç”¨è¯´æ˜è¡¨ ==========
    ws_help = wb.create_sheet("ä½¿ç”¨è¯´æ˜", 6)
    
    help_data = [
        ["ğŸ“– å¤šç³»ç»Ÿç¯å¢ƒExcelæ¨¡æ¿ä½¿ç”¨è¯´æ˜"],
        [""],
        ["1ï¸âƒ£  ç³»ç»Ÿæ¸…å•è¡¨"],
        ["   - å¡«å†™æ‰€æœ‰ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯"],
        ["   - æ¯ä¸ªç³»ç»Ÿä¸€è¡Œ"],
        ["   - ç³»ç»Ÿç±»å‹ï¼šæ ¸å¿ƒ/è¾…åŠ©/å¤–å›´"],
        ["   - æ•°æ®æ•æ„Ÿåº¦ï¼šä½/ä¸­/é«˜"],
        [""],
        ["2ï¸âƒ£  éƒ¨ç½²æ¶æ„è¡¨"],
        ["   - å¡«å†™éƒ¨ç½²æ‹“æ‰‘ä¿¡æ¯"],
        ["   - é€‰æ‹©éƒ¨ç½²æ¨¡å¼"],
        ["   - å¡«å†™ç½‘ç»œå‚æ•°"],
        ["   - è®¾ç½®RPO/RTOç›®æ ‡"],
        [""],
        ["3ï¸âƒ£  æ±‡æ€»ä¿¡æ¯è¡¨"],
        ["   - å¡«å†™é¡¹ç›®åŸºæœ¬ä¿¡æ¯"],
        ["   - éƒ¨åˆ†æ•°æ®ä¼šè‡ªåŠ¨ç»Ÿè®¡"],
        ["   - å¡«å†™ä¸šåŠ¡ç‰¹å¾"],
        [""],
        ["4ï¸âƒ£  æ€§èƒ½è¦æ±‚è¡¨"],
        ["   - å¡«å†™æ€§èƒ½æŒ‡æ ‡è¦æ±‚"],
        ["   - è®¾ç½®å“åº”æ—¶é—´ç›®æ ‡"],
        ["   - é…ç½®æ‰©å±•ç­–ç•¥"],
        [""],
        ["5ï¸âƒ£  å®‰å…¨åˆè§„è¡¨"],
        ["   - å¡«å†™å®‰å…¨è¦æ±‚"],
        ["   - é€‰æ‹©åˆè§„æ ‡å‡†"],
        ["   - é…ç½®åŠ å¯†ç­–ç•¥"],
        [""],
        ["6ï¸âƒ£  å¤‡ä»½ç­–ç•¥è¡¨"],
        ["   - é…ç½®å¤‡ä»½ç­–ç•¥"],
        ["   - è®¾ç½®å¤‡ä»½é¢‘ç‡"],
        ["   - è§„åˆ’å¤‡ä»½ä¿ç•™"],
        [""],
        ["ğŸ’¡ æç¤º"],
        ["   - å¸¦*çš„å­—æ®µä¸ºå¿…å¡«"],
        ["   - ä¸‹æ‹‰é€‰é¡¹è¯·ä»åˆ—è¡¨ä¸­é€‰æ‹©"],
        ["   - æ•°å€¼å­—æ®µè¯·å¡«å†™æ•°å­—"],
        ["   - å®Œæˆåä¿å­˜å¹¶ä¸Šä¼ åˆ°ç³»ç»Ÿ"],
        [""],
        ["ğŸ“ æŠ€æœ¯æ”¯æŒ"],
        ["   - è¯¦ç»†æ–‡æ¡£ï¼šå¤šç³»ç»Ÿå¤æ‚éƒ¨ç½²ä½¿ç”¨æŒ‡å—.md"],
        ["   - å‚æ•°è¯´æ˜ï¼šä¸“ä¸šå‚æ•°è¯´æ˜æ–‡æ¡£.md"],
    ]
    
    for row_data in help_data:
        ws_help.append(row_data)
    
    # è®¾ç½®ä½¿ç”¨è¯´æ˜çš„æ ·å¼
    for row in ws_help.iter_rows(min_row=1, max_row=ws_help.max_row):
        for cell in row:
            cell.font = Font(name='å¾®è½¯é›…é»‘', size=11)
            cell.alignment = Alignment(horizontal='left', vertical='top', wrap_text=True)
    
    ws_help.column_dimensions['A'].width = 80
    
    # ä¿å­˜æ–‡ä»¶
    wb.save(filename)
    print(f"âœ… æ¨¡æ¿æ–‡ä»¶å·²åˆ›å»º: {filename}")
    
    return filename


def _style_worksheet(ws, headers):
    """è®¾ç½®å·¥ä½œè¡¨æ ·å¼"""
    
    # è¡¨å¤´æ ·å¼
    header_fill = PatternFill(start_color="4472C4", end_color="4472C4", fill_type="solid")
    header_font = Font(name='å¾®è½¯é›…é»‘', size=11, bold=True, color="FFFFFF")
    
    # è¾¹æ¡†
    thin_border = Border(
        left=Side(style='thin'),
        right=Side(style='thin'),
        top=Side(style='thin'),
        bottom=Side(style='thin')
    )
    
    # è®¾ç½®è¡¨å¤´
    for col_num, header in enumerate(headers, 1):
        cell = ws.cell(row=1, column=col_num)
        cell.fill = header_fill
        cell.font = header_font
        cell.alignment = Alignment(horizontal='center', vertical='center')
        cell.border = thin_border
    
    # è®¾ç½®æ•°æ®è¡Œ
    for row in ws.iter_rows(min_row=2, max_row=ws.max_row):
        for cell in row:
            cell.font = Font(name='å¾®è½¯é›…é»‘', size=10)
            cell.alignment = Alignment(horizontal='left', vertical='center')
            cell.border = thin_border
    
    # è‡ªåŠ¨è°ƒæ•´åˆ—å®½
    for column in ws.columns:
        max_length = 0
        column_letter = column[0].column_letter
        
        for cell in column:
            try:
                if len(str(cell.value)) > max_length:
                    max_length = len(str(cell.value))
            except:
                pass
        
        adjusted_width = min(max_length + 2, 50)
        ws.column_dimensions[column_letter].width = adjusted_width
    
    # å†»ç»“é¦–è¡Œ
    ws.freeze_panes = 'A2'


if __name__ == '__main__':
    print("=" * 60)
    print("ğŸ“ åˆ›å»ºå¤šç³»ç»Ÿç¯å¢ƒExcelæ¨¡æ¿")
    print("=" * 60)
    
    filename = create_multi_system_template()
    
    print("\nâœ… æ¨¡æ¿åŒ…å«ä»¥ä¸‹å·¥ä½œè¡¨:")
    print("   1. ç³»ç»Ÿæ¸…å• - å¡«å†™æ‰€æœ‰ç³»ç»Ÿä¿¡æ¯")
    print("   2. éƒ¨ç½²æ¶æ„ - é…ç½®éƒ¨ç½²æ‹“æ‰‘")
    print("   3. æ±‡æ€»ä¿¡æ¯ - é¡¹ç›®åŸºæœ¬ä¿¡æ¯")
    print("   4. æ€§èƒ½è¦æ±‚ - æ€§èƒ½æŒ‡æ ‡è¦æ±‚")
    print("   5. å®‰å…¨åˆè§„ - å®‰å…¨å’Œåˆè§„é…ç½®")
    print("   6. å¤‡ä»½ç­–ç•¥ - å¤‡ä»½ç­–ç•¥é…ç½®")
    print("   7. ä½¿ç”¨è¯´æ˜ - æ¨¡æ¿ä½¿ç”¨æŒ‡å—")
    
    print("\nğŸ’¡ ä½¿ç”¨æ–¹æ³•:")
    print("   1. æ‰“å¼€Excelæ–‡ä»¶")
    print("   2. æ ¹æ®å®é™…æƒ…å†µå¡«å†™å„ä¸ªå·¥ä½œè¡¨")
    print("   3. ä¿å­˜æ–‡ä»¶")
    print("   4. ä¸Šä¼ åˆ°ç³»ç»Ÿè¿›è¡Œåˆ†æ")
    
    print("\n" + "=" * 60)
