# 🌐 域名直接访问配置指南

## 目标
实现通过 `http://aladdinsun.devcloud.woa.com` 直接访问，无需指定端口号

## 当前配置
- **应用端口**: 18080（5位数）
- **监听地址**: 0.0.0.0:18080

## 🔧 配置步骤

### 方案 1：在 iOA 中配置端口映射（推荐）

1. **打开 iOA 客户端**
2. **进入云研发** → 找到环境 `aladdinsun-23thglr84a`
3. **点击「更多」→「环境详情」**
4. **配置端口转发**：
   - 容器端口：`18080`
   - 外部端口：`80`（HTTP 默认端口）
   - 协议：TCP
   - 域名：`aladdinsun.devcloud.woa.com`

配置完成后，访问 `http://aladdinsun.devcloud.woa.com` 会自动转发到容器的 18080 端口。

### 方案 2：在 AnyDev 环境设置中配置

1. **打开 iOA** → 云研发 → 环境详情
2. **找到「域名设置」或「端口映射」**
3. **设置默认端口映射**：
   - 自定义域名：`aladdinsun.devcloud.woa.com`
   - 目标端口：`18080`
   - 外部访问端口：`80`（或留空使用默认）

### 方案 3：使用 Nginx 反向代理（高级）

如果 AnyDev 环境支持，可以在容器内安装 Nginx：

```bash
# 安装 Nginx
yum install nginx -y

# 配置 Nginx
cat > /etc/nginx/conf.d/tdsql.conf << 'EOF'
server {
    listen 80;
    server_name aladdinsun.devcloud.woa.com;
    
    location / {
        proxy_pass http://127.0.0.1:18080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

# 启动 Nginx
systemctl start nginx
systemctl enable nginx
```

然后在 iOA 中配置端口转发：
- 容器端口：80
- 外部访问：通过域名

## 🔐 HTTPS 加密配置

### 在 iOA 中启用 HTTPS

1. **环境详情** → **安全设置**
2. **启用 HTTPS**
3. **选择证书**：
   - 使用 AnyDev 提供的默认证书
   - 或上传自定义证书

### 申请腾讯内部证书

1. 访问证书管理平台：https://cam.it.woa.com/certificate/operate?type=1
2. 申请域名证书：`aladdinsun.devcloud.woa.com`
3. 下载证书和密钥
4. 在 iOA 环境详情中上传证书

配置完成后，可以通过 `https://aladdinsun.devcloud.woa.com` 访问

## 📋 验证配置

配置完成后，测试访问：

```bash
# 测试 HTTP 访问
curl -I http://aladdinsun.devcloud.woa.com

# 测试 HTTPS 访问（如果配置了）
curl -I https://aladdinsun.devcloud.woa.com
```

## 💡 重要提示

1. **端口映射优先级**：
   - iOA 端口转发配置 > 容器内部配置
   - 确保在 iOA 中正确配置端口映射

2. **域名生效时间**：
   - 端口映射配置后，可能需要 1-5 分钟生效
   - 如果不生效，尝试重启环境

3. **访问测试**：
   - 先在公司内网测试
   - 确认配置正确后再进行外网访问

## 🎯 最终效果

配置完成后：
- ✅ `http://aladdinsun.devcloud.woa.com` → 直接访问（无需端口号）
- ✅ `https://aladdinsun.devcloud.woa.com` → HTTPS 加密访问（如果配置）
- ✅ 所有功能页面都可以通过域名访问

## 📞 需要帮助？

如果配置过程中遇到问题：
1. 检查 iOA 中的端口转发配置
2. 查看环境日志：`tail -f /data/workspace/tencent_CodeBuddy/aladdinsun/AIdatabase/app.log`
3. 联系 AnyDev 支持团队
