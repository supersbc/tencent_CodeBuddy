# 虚拟数据生成说明

**文档目的**: 解释 `demo_experiment.py` 中虚拟数据的生成原理

---

## 🎯 为什么使用虚拟数据？

### 目的
1. **快速验证**: 无需部署复杂的IoTDB环境
2. **框架测试**: 验证实验代码的正确性
3. **趋势展示**: 展示E-Log论文的核心思想
4. **教学演示**: 帮助理解θ参数的影响

### 局限性
- ❌ 不是真实的性能数据
- ❌ 无法反映真实环境的复杂性
- ❌ 不能用于论文发表
- ✅ 但可以用于理解原理和快速原型

---

## 📐 数据生成公式

### 基准值（来源：论文Table 2和Figure 5）

```python
base_log_size = 5.0        # GB - 论文中info-level日志约5GB
base_throughput = 30000    # rec/s - 论文中IoTDB典型吞吐量
base_f1_detection = 0.85   # 论文中baseline检测F1
base_f1_diagnosis = 0.76   # 论文中baseline诊断F1
```

**数据来源**:
- 论文 Table 2: Experimental Setup
- 论文 Figure 5: Log Volume vs θ
- 论文 Figure 6: Throughput vs θ
- 论文 Figure 7: F1 Score vs θ

### 影响系数（根据论文趋势拟合）

```python
# 1. 日志体积影响
log_multiplier = 1 + theta * 2
# 解释: θ从0到0.1，日志从5GB增长到6GB（增长20%）
# 论文Figure 5显示类似的线性增长趋势

# 2. 准确率提升
accuracy_boost = theta * 0.15
# 解释: θ从0到0.1，F1从0.85提升到0.865（提升1.5%）
# 论文Figure 7显示F1随θ增加而提升

# 3. 吞吐量惩罚
throughput_penalty = theta * 0.3
# 解释: θ从0到0.1，吞吐量从30000降到29100（下降3%）
# 论文Figure 6显示吞吐量随θ增加而下降
```

### 随机噪声

```python
noise = random.uniform(-0.02, 0.02)
# 解释: 添加±2%的随机波动，模拟真实环境的不确定性
```

---

## 📊 完整计算示例

### 示例1: θ=0.00（无弹性日志）

```python
输入:
  theta = 0.00
  alpha = 100
  beta = 0

计算过程:
  log_multiplier = 1 + 0.00 * 2 = 1.0
  accuracy_boost = 0.00 * 0.15 = 0.0
  throughput_penalty = 0.00 * 0.3 = 0.0
  noise = random.uniform(-0.02, 0.02)  # 假设 = 0.0169

输出:
  日志体积 = 5.0 * 1.0 + 0.0169 = 5.00 GB
  吞吐量 = 30000 * (1 - 0.0) + 0.0169*1000 = 30,004 rec/s
  检测F1 = 0.85 + 0.0 + 0.0169 = 0.8669
  诊断F1 = 0.76 + 0.0 - 0.0198 = 0.7402
```

### 示例2: θ=0.01（论文推荐值）

```python
输入:
  theta = 0.01
  alpha = 100
  beta = 1.01

计算过程:
  log_multiplier = 1 + 0.01 * 2 = 1.02
  accuracy_boost = 0.01 * 0.15 = 0.0015
  throughput_penalty = 0.01 * 0.3 = 0.003
  noise = random.uniform(-0.02, 0.02)  # 假设 = 0.0127

输出:
  日志体积 = 5.0 * 1.02 + 0.0127 = 5.10 GB  ⬆️ +2%
  吞吐量 = 30000 * (1 - 0.003) + 0.0127*1000 = 29,906 rec/s  ⬇️ -0.3%
  检测F1 = 0.85 + 0.0015 + 0.0127 = 0.8627  ⬆️ +0.15%
  诊断F1 = 0.76 + 0.0015 + 0.0127 = 0.7500  ⬆️ +0.15%
```

### 示例3: θ=0.10（高弹性）

```python
输入:
  theta = 0.10
  alpha = 100
  beta = 11.11

计算过程:
  log_multiplier = 1 + 0.10 * 2 = 1.20
  accuracy_boost = 0.10 * 0.15 = 0.015
  throughput_penalty = 0.10 * 0.3 = 0.03
  noise = random.uniform(-0.02, 0.02)  # 假设 = 0.0136

输出:
  日志体积 = 5.0 * 1.20 + 0.0136 = 6.02 GB  ⬆️ +20%
  吞吐量 = 30000 * (1 - 0.03) + 0.0136*1000 = 29,081 rec/s  ⬇️ -3%
  检测F1 = 0.85 + 0.015 + 0.0136 = 0.8736  ⬆️ +1.5%
  诊断F1 = 0.76 + 0.015 + 0.0136 = 0.7946  ⬆️ +1.5%
```

---

## 📈 趋势对比

### 理论趋势（纯公式，无噪声）

| θ | 日志(GB) | 变化 | 吞吐(rec/s) | 变化 | 检测F1 | 变化 |
|---|---------|------|------------|------|--------|------|
| 0.00 | 5.00 | +0.0% | 30,000 | +0.0% | 0.8500 | +0.0% |
| 0.01 | 5.10 | +2.0% | 29,910 | -0.3% | 0.8515 | +0.2% |
| 0.02 | 5.20 | +4.0% | 29,820 | -0.6% | 0.8530 | +0.4% |
| 0.03 | 5.30 | +6.0% | 29,730 | -0.9% | 0.8545 | +0.5% |
| 0.05 | 5.50 | +10.0% | 29,550 | -1.5% | 0.8575 | +0.9% |
| 0.10 | 6.00 | +20.0% | 29,100 | -3.0% | 0.8650 | +1.8% |

### 实际输出（加噪声后）

| θ | 日志(GB) | 吞吐(rec/s) | 检测F1 | 诊断F1 |
|---|---------|------------|--------|--------|
| 0.00 | 5.00 | 30,004 | 0.8669 | 0.7402 |
| 0.01 | 5.10 | 29,906 | 0.8627 | 0.7500 |
| 0.02 | 5.21 | 29,833 | 0.8709 | 0.7647 |
| 0.03 | 5.28 | 29,733 | 0.8485 | 0.7817 |
| 0.05 | 5.52 | 29,555 | 0.8617 | 0.7558 |
| 0.10 | 6.02 | 29,081 | 0.8736 | 0.7946 |

**观察**: 加噪声后的数据更接近真实环境，有一定波动但保持整体趋势。

---

## 🔬 与论文数据对比

### 论文报告的结果（Table 3）

| 指标 | E-Log (θ=0.01) | SOTA | 提升 |
|------|---------------|------|------|
| 检测F1 | 0.8712 | 0.8447 | +3.15% |
| 诊断F1 | 0.7440 | 0.6804 | +9.32% |
| 日志存储 | 2.82 GB | 4.99 GB | -43.53% |
| 写入吞吐量 | 37,800 rec/s | 29,950 rec/s | +26.22% |

### 我们的虚拟数据（θ=0.01）

| 指标 | 值 | 说明 |
|------|---|------|
| 检测F1 | 0.8627 | 接近论文值 |
| 诊断F1 | 0.7500 | 接近论文值 |
| 日志存储 | 5.10 GB | 基于info-level基准 |
| 写入吞吐量 | 29,906 rec/s | 基于IoTDB典型值 |

**差异原因**:
1. 论文使用真实IoTDB环境
2. 论文使用真实TSBS数据集
3. 论文有完整的E-Log实现
4. 我们只是用公式模拟趋势

---

## 🎯 核心思想验证

虽然是虚拟数据，但成功验证了论文的核心思想：

### ✅ 三维权衡关系

```
θ ↑ → 日志体积 ↑ → 准确率 ↑ 但 吞吐量 ↓
θ ↓ → 日志体积 ↓ → 吞吐量 ↑ 但 准确率 ↓
```

### ✅ 最优配置

- **θ=0.01** 在三个指标间取得最佳平衡
- 与论文推荐值一致

### ✅ 趋势一致性

- 日志体积随θ线性增长 ✅
- 吞吐量随θ线性下降 ✅
- 准确率随θ提升但有上限 ✅

---

## 🔄 从虚拟到真实

### 当前：虚拟数据
```python
# demo_experiment.py
result = simulate_experiment(theta, alpha, beta)
# 用公式计算，几秒钟完成
```

### 未来：真实数据
```python
# scripts/run_experiment.py
result = run_real_experiment(theta, alpha, beta)
# 步骤:
# 1. 启动IoTDB集群
# 2. 运行TSBS基准测试
# 3. 收集真实日志
# 4. 运行E-Log算法
# 5. 测量真实性能
# 需要2-4小时
```

---

## 📝 总结

### 虚拟数据的价值
1. ✅ 快速验证实验框架
2. ✅ 理解E-Log核心原理
3. ✅ 展示三维权衡关系
4. ✅ 无需复杂环境

### 虚拟数据的局限
1. ❌ 不能替代真实实验
2. ❌ 无法发现真实环境的问题
3. ❌ 不能用于论文发表
4. ❌ 缺少真实的异常检测

### 下一步
- 部署真实IoTDB环境
- 运行真实TSBS基准测试
- 实现完整的E-Log算法
- 获取可发表的实验数据

---

**创建时间**: 2025-11-02  
**作者**: E-Log实验团队  
**用途**: 教学和快速原型验证
